<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lean: Research/QuantBook.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lean
   &#160;<span id="projectnumber">$LEAN_TAG$</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('QuantBook_8cs_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">QuantBook.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * QUANTCONNECT.COM - Democratizing Finance, Empowering Individuals.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Lean Algorithmic Trading Engine v2.0. Copyright 2014 QuantConnect Corporation.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * limitations under the License.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html#acc7f7c0d72467529ed61916871bd54b6aa7f5f35426b927411fc9231b56382173" title="Python Language Project (4)">Python</a>.Runtime;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Algorithm.html">Algorithm</a>;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Configuration.html">Configuration</a>;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Data.html">Data</a>;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Data.html">Data</a>.<a class="code" href="namespaceQuantConnect_1_1Data_1_1Fundamental.html">Fundamental</a>;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Data.html">Data</a>.<a class="code" href="namespaceQuantConnect_1_1Data_1_1Market.html">Market</a>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Indicators.html">Indicators</a>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Interfaces.html">Interfaces</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Lean.html">Lean</a>.<a class="code" href="namespaceQuantConnect_1_1Lean_1_1Engine.html">Engine</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Lean.html">Lean</a>.<a class="code" href="namespaceQuantConnect_1_1Lean_1_1Engine.html">Engine</a>.<a class="code" href="namespaceQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds.html">DataFeeds</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Lean.html">Lean</a>.<a class="code" href="namespaceQuantConnect_1_1Lean_1_1Engine.html">Engine</a>.<a class="code" href="namespaceQuantConnect_1_1Lean_1_1Engine_1_1HistoricalData.html">HistoricalData</a>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Securities.html">Securities</a>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Securities.html">Securities</a>.<a class="code" href="namespaceQuantConnect_1_1Securities_1_1Future.html">Future</a>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Securities.html">Securities</a>.<a class="code" href="namespaceQuantConnect_1_1Securities_1_1Option.html">Option</a>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Statistics.html">Statistics</a>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Util.html">Util</a>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using</span> System.IO;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">using</span> System.Linq;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Packets.html">Packets</a>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">using</span> System.Threading.Tasks;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Data.html">Data</a>.<a class="code" href="namespaceQuantConnect_1_1Data_1_1UniverseSelection.html">UniverseSelection</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Lean.html">Lean</a>.<a class="code" href="namespaceQuantConnect_1_1Lean_1_1Engine.html">Engine</a>.<a class="code" href="namespaceQuantConnect_1_1Lean_1_1Engine_1_1Setup.html">Setup</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceQuantConnect_1_1Research.html">QuantConnect.Research</a></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{<span class="comment"></span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">    /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">    /// Provides access to data for quantitative analysis</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">    /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html">   46</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html" title="Provides access to data for quantitative analysis">QuantBook</a> : <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html" title="QC Algorithm Base Class - Handle the basic requirements of a trading algorithm, allowing user to focu...">QCAlgorithm</a></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keyword">private</span> dynamic _pandas;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keyword">private</span> <a class="code" href="interfaceQuantConnect_1_1Interfaces_1_1IDataCacheProvider.html" title="Defines a cache for data">IDataCacheProvider</a> _dataCacheProvider;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keyword">private</span> <a class="code" href="interfaceQuantConnect_1_1Interfaces_1_1IDataProvider.html" title="Fetches a remote file for a security. Must save the file to Globals.DataFolder.">IDataProvider</a> _dataProvider;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> _isPythonNotebook;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html" title="Provides access to data for quantitative analysis">QuantBook</a>()</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <span class="comment">//Determine if we are in a Python Notebook</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="keywordflow">try</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                PythonEngine.<a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a9b5dc3e2a5fa525e75b528e5ce81b274" title="Initialise the data and resolution required, as well as the cash and start-end dates for your algorit...">Initialize</a>();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                <span class="keyword">using</span> (Py.GIL())</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                    var isPython = PyModule.FromString(Guid.NewGuid().ToString(),</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                        <span class="stringliteral">&quot;try:\n&quot;</span> +</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                        <span class="stringliteral">&quot;   import IPython\n&quot;</span> +</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                        <span class="stringliteral">&quot;   def IsPythonNotebook():\n&quot;</span> +</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                        <span class="stringliteral">&quot;       return (IPython.get_ipython() != None)\n&quot;</span> +</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                        <span class="stringliteral">&quot;except:\n&quot;</span> +</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                        <span class="stringliteral">&quot;   print(&#39;No IPython installed&#39;)\n&quot;</span> +</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                        <span class="stringliteral">&quot;   def IsPythonNotebook():\n&quot;</span> +</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                        <span class="stringliteral">&quot;       return false\n&quot;</span>).GetAttr(<span class="stringliteral">&quot;IsPythonNotebook&quot;</span>).Invoke();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                    isPython.TryConvert(out _isPythonNotebook);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordflow">catch</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="comment">//Default to false</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                _isPythonNotebook = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                Logging.Log.Error(<span class="stringliteral">&quot;QuantBook failed to determine Notebook kernel language&quot;</span>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            RecycleMemory();</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            Logging.Log.Trace($<span class="stringliteral">&quot;QuantBook started; Is Python: {_isPythonNotebook}&quot;</span>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">        /// &lt;see cref = &quot;QuantBook&quot; /&gt; constructor.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">        /// Provides access to data for quantitative analysis</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a239bcca3c726a8cc25b9a6a3cd0c244f">   89</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a239bcca3c726a8cc25b9a6a3cd0c244f" title="QuantBook constructor. Provides access to data for quantitative analysis">QuantBook</a>() : base()</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">try</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keyword">using</span> (Py.GIL())</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    _pandas = Py.Import(<span class="stringliteral">&quot;pandas&quot;</span>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="comment">// Issue #4892 : Set start time relative to NY time</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="comment">// when the data is available from the previous day</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                var newYorkTime = DateTime.UtcNow.ConvertFromUtc(<a class="code" href="classQuantConnect_1_1TimeZones.html" title="Provides access to common time zones">TimeZones</a>.<a class="code" href="classQuantConnect_1_1TimeZones.html#aa530de3201390d37c1796bcbd3f3af7a" title="Gets the time zone for New York City, USA. This is a daylight savings time zone.">NewYork</a>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                var hourThreshold = <a class="code" href="classQuantConnect_1_1Configuration_1_1Config.html" title="Configuration class loads the required external setup variables to launch the Lean engine.">Config</a>.<a class="code" href="classQuantConnect_1_1Configuration_1_1Config.html#a7e8e4f537e349a84b9a2b0f7d3153a0b" title="Get the int value of a config string.">GetInt</a>(<span class="stringliteral">&quot;qb-data-hour&quot;</span>, 9);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="comment">// If it is after our hour threshold; then we can use today</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">if</span> (newYorkTime.Hour &gt;= hourThreshold)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a6a75c840c3180f42f4888649d51cb092" title="Set the start date for backtest.">SetStartDate</a>(newYorkTime);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a6a75c840c3180f42f4888649d51cb092" title="Set the start date for backtest.">SetStartDate</a>(newYorkTime - TimeSpan.FromDays(1));</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                <span class="comment">// Sets PandasConverter</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a5c640b7fccbc4512933db04457180fac" title="Sets pandas converter">SetPandasConverter</a>();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                <span class="comment">// Reset our composer; needed for re-creation of QuantBook</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <a class="code" href="classQuantConnect_1_1Util_1_1Composer.html" title="Provides methods for obtaining exported MEF instances">Composer</a>.<a class="code" href="classQuantConnect_1_1Util_1_1Composer.html#a41c561733f9f9f866a93ff6062988f0a" title="Gets the singleton instance">Instance</a>.<a class="code" href="classQuantConnect_1_1Util_1_1Composer.html#a90819143fabdc752a553aa5c99575064" title="Clears the cache of exported values, causing new instances to be created.">Reset</a>();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                var composer = <a class="code" href="classQuantConnect_1_1Util_1_1Composer.html" title="Provides methods for obtaining exported MEF instances">Composer</a>.<a class="code" href="classQuantConnect_1_1Util_1_1Composer.html#a41c561733f9f9f866a93ff6062988f0a" title="Gets the singleton instance">Instance</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <a class="code" href="classQuantConnect_1_1Configuration_1_1Config.html" title="Configuration class loads the required external setup variables to launch the Lean engine.">Config</a>.<a class="code" href="classQuantConnect_1_1Configuration_1_1Config.html#af1a3c386f7c01ad9df460302abb7336d" title="Resets the config settings to their default values. Called in regression tests where multiple algorit...">Reset</a>();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="comment">// Create our handlers with our composer instance</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                var systemHandlers = <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1LeanEngineSystemHandlers.html" title="Provides a container for the system level handlers">LeanEngineSystemHandlers</a>.<a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1LeanEngineSystemHandlers.html#ab6dc3eec10dc442e3b625b8282cec7be" title="Creates a new instance of the LeanEngineSystemHandlers class from the specified composer using type n...">FromConfiguration</a>(composer);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                <span class="comment">// init the API</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                systemHandlers.<a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1LeanEngineSystemHandlers.html#aeec8d5663f22422a0c85f80d2b1bc685" title="Initializes the Api, Messaging, and JobQueue components">Initialize</a>();</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                var algorithmHandlers = <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1LeanEngineAlgorithmHandlers.html" title="Provides a container for the algorithm specific handlers">LeanEngineAlgorithmHandlers</a>.<a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1LeanEngineAlgorithmHandlers.html#a9737f33c09743080ebc70bcd06241110" title="Creates a new instance of the LeanEngineAlgorithmHandlers class from the specified composer using typ...">FromConfiguration</a>(composer, researchMode: <span class="keyword">true</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                var algorithmPacket = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Packets_1_1BacktestNodePacket.html" title="Algorithm backtest task information packet.">BacktestNodePacket</a></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    UserToken = <a class="code" href="classQuantConnect_1_1Globals.html" title="Provides application level constant values">Globals</a>.<a class="code" href="classQuantConnect_1_1Globals.html#a5c401517495e734e418c49127cc7da87" title="The user token">UserToken</a>,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    UserId = <a class="code" href="classQuantConnect_1_1Globals.html" title="Provides application level constant values">Globals</a>.<a class="code" href="classQuantConnect_1_1Globals.html#a59295e8223adac4a346017d70e61feb1" title="The user Id">UserId</a>,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a02681bfa90c7a8ac8e68c87f5f427638" title="The project id associated with this algorithm if any">ProjectId</a> = <a class="code" href="classQuantConnect_1_1Globals.html" title="Provides application level constant values">Globals</a>.<a class="code" href="classQuantConnect_1_1Globals.html#ad2d10e62e8fa92bd8984b5b9417bc26f" title="The project id">ProjectId</a>,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    OrganizationId = <a class="code" href="classQuantConnect_1_1Globals.html" title="Provides application level constant values">Globals</a>.<a class="code" href="classQuantConnect_1_1Globals.html#ac2d669d94272a5fdf09f9287997dd786" title="The organization id">OrganizationID</a>,</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    Version = <a class="code" href="classQuantConnect_1_1Globals.html" title="Provides application level constant values">Globals</a>.<a class="code" href="classQuantConnect_1_1Globals.html#a00a1fc452df10500a5e3d05ce36d87b4" title="The version of lean">Version</a></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                };</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a02681bfa90c7a8ac8e68c87f5f427638" title="The project id associated with this algorithm if any">ProjectId</a> = algorithmPacket.ProjectId;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                systemHandlers.LeanManager.Initialize(systemHandlers,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                    algorithmHandlers,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                    algorithmPacket,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                    <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1AlgorithmManager.html" title="Algorithm manager class executes the algorithm and generates and passes through the algorithm events.">AlgorithmManager</a>(<span class="keyword">false</span>));</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                systemHandlers.LeanManager.SetAlgorithm(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                algorithmHandlers.DataPermissionsManager.Initialize(algorithmPacket);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                algorithmHandlers.ObjectStore.Initialize(algorithmPacket.UserId,</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    algorithmPacket.ProjectId,</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                    algorithmPacket.UserToken,</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Packets_1_1Controls.html" title="Specifies values used to control algorithm limits">Controls</a></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                        <span class="comment">// if &lt;= 0 we disable periodic persistence and make it synchronous</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        PersistenceIntervalSeconds = -1,</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        StorageLimit = Config.GetValue(<span class="stringliteral">&quot;storage-limit&quot;</span>, 10737418240L),</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        StorageFileCount = Config.GetInt(<span class="stringliteral">&quot;storage-file-count&quot;</span>, 10000),</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        StoragePermissions = (FileAccess) Config.GetInt(<span class="stringliteral">&quot;storage-permissions&quot;</span>, (int)FileAccess.ReadWrite)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                    });</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#adb6f4d45841ad9493a30197a3a503e64" title="Sets the object store">SetObjectStore</a>(algorithmHandlers.ObjectStore);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                _dataCacheProvider = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds_1_1ZipDataCacheProvider.html" title="File provider implements optimized zip archives caching facility. Cache is thread safe.">ZipDataCacheProvider</a>(algorithmHandlers.DataProvider);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                _dataProvider = algorithmHandlers.DataProvider;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                var symbolPropertiesDataBase = <a class="code" href="classQuantConnect_1_1Securities_1_1SymbolPropertiesDatabase.html" title="Provides access to specific properties for various symbols">SymbolPropertiesDatabase</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SymbolPropertiesDatabase.html#aee26fb588793fd311c44eb8b2909cc33" title="Gets the instance of the SymbolPropertiesDatabase class produced by reading in the symbol properties ...">FromDataFolder</a>();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                var registeredTypes = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Securities_1_1RegisteredSecurityDataTypesProvider.html" title="Provides an implementation of IRegisteredSecurityDataTypesProvider that permits the consumer to modif...">RegisteredSecurityDataTypesProvider</a>();</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                var securityService = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Securities_1_1SecurityService.html" title="This class implements interface ISecurityService providing methods for creating new Security">SecurityService</a>(<a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a442dd9df68f2b04aaaa9058e12c3fd1b" title="Portfolio object provieds easy access to the underlying security-holding properties; summed together ...">Portfolio</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityPortfolioManager.html#a55b9064f1409763e64d164941a045b11" title="Gets the cash book that keeps track of all currency holdings (only settled cash)">CashBook</a>,</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    <a class="code" href="classQuantConnect_1_1Securities_1_1MarketHoursDatabase.html" title="Provides access to exchange hours and raw data times zones in various markets">MarketHoursDatabase</a>,</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    symbolPropertiesDataBase,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    <span class="keyword">this</span>,</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    registeredTypes,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCacheProvider.html" title="A helper class that will provide SecurityCache instances">SecurityCacheProvider</a>(<a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a442dd9df68f2b04aaaa9058e12c3fd1b" title="Portfolio object provieds easy access to the underlying security-holding properties; summed together ...">Portfolio</a>),</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    algorithm: <span class="keyword">this</span>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a6567d757b9c20c4b935d3f785676bfe3" title="Security collection is an array of the security objects such as Equities and FOREX....">Securities</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityManager.html#ab6c2be9c57a78ddc444dc33cdea09da9" title="Sets the Security Service to be used">SetSecurityService</a>(securityService);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <a class="code" href="classQuantConnect_1_1Data_1_1SubscriptionManager.html" title="Enumerable Subscription Management Class">SubscriptionManager</a>.<a class="code" href="classQuantConnect_1_1Data_1_1SubscriptionManager.html#a1403f5efbb1b3fb6c79ca059f41f8689" title="Sets the Subscription Manager">SetDataManager</a>(</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds_1_1DataManager.html" title="DataManager will manage the subscriptions for both the DataFeeds and the SubscriptionManager">DataManager</a>(<span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds_1_1NullDataFeed.html" title="Null data feed implementation. DataManager">NullDataFeed</a>(),</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#af3feec174f44f240f4dfb2a2c118499b" title="Gets or sets the universe selection model.">UniverseSelection</a>(<span class="keyword">this</span>, securityService, algorithmHandlers.DataPermissionsManager, algorithmHandlers.DataProvider),</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                        <span class="keyword">this</span>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                        <a class="code" href="classQuantConnect_1_1TimeKeeper.html" title="Provides a means of centralizing time for various time zones.">TimeKeeper</a>,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        <a class="code" href="classQuantConnect_1_1Securities_1_1MarketHoursDatabase.html" title="Provides access to exchange hours and raw data times zones in various markets">MarketHoursDatabase</a>,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                        <span class="keyword">false</span>,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                        registeredTypes,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                        algorithmHandlers.DataPermissionsManager));</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                var mapFileProvider = algorithmHandlers.MapFileProvider;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a09e4deec24cd76fca0ad3fd44ae20cda" title="Gets or sets the history provider for the algorithm">HistoryProvider</a> = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1HistoricalData_1_1HistoryProviderManager.html" title="Provides an implementation of IHistoryProvider which acts as a wrapper to use multiple history provid...">HistoryProviderManager</a>();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a09e4deec24cd76fca0ad3fd44ae20cda" title="Gets or sets the history provider for the algorithm">HistoryProvider</a>.<a class="code" href="interfaceQuantConnect_1_1Interfaces_1_1IHistoryProvider.html#a519155bfe8e14087cfad574a1382ec42" title="Initializes this history provider to work for the specified job">Initialize</a>(</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Data_1_1HistoryProviderInitializeParameters.html" title="Represents the set of parameters for the IHistoryProvider.Initialize method">HistoryProviderInitializeParameters</a>(</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                        <span class="keyword">null</span>,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                        <span class="keyword">null</span>,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                        algorithmHandlers.DataProvider,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                        _dataCacheProvider,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                        mapFileProvider,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                        algorithmHandlers.FactorFileProvider,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                        <span class="keyword">null</span>,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        <span class="keyword">true</span>,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        algorithmHandlers.DataPermissionsManager,</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                        <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#aac77f8136f4f81065027b841e301f921" title="Gets the object store, used for persistence">ObjectStore</a></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    )</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                );</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a41c821f02c105c326f8f96b654f98e2c" title="Sets the option chain provider, used to get the list of option contracts for an underlying symbol">SetOptionChainProvider</a>(<span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds_1_1CachingOptionChainProvider.html" title="An implementation of IOptionChainProvider that will cache by date option contracts returned by anothe...">CachingOptionChainProvider</a>(<span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds_1_1BacktestingOptionChainProvider.html" title="An implementation of IOptionChainProvider that reads the list of contracts from open interest zip dat...">BacktestingOptionChainProvider</a>(_dataCacheProvider, mapFileProvider)));</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#abf6f4d9d6c3cdd581b95c5fcfc2ac250" title="Sets the future chain provider, used to get the list of future contracts for an underlying symbol">SetFutureChainProvider</a>(<span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds_1_1CachingFutureChainProvider.html" title="An implementation of IFutureChainProvider that will cache by date future contracts returned by anothe...">CachingFutureChainProvider</a>(<span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1DataFeeds_1_1BacktestingFutureChainProvider.html" title="An implementation of IFutureChainProvider that reads the list of contracts from open interest zip dat...">BacktestingFutureChainProvider</a>(_dataCacheProvider)));</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#ae26809cf17dd004b076d8cc563862770" title="Sets the algorithm running mode">SetAlgorithmMode</a>(<a class="code" href="namespaceQuantConnect.html#a11f3427843701b79418a4a1bc919215e" title="Represents the deployment modes of an algorithm">AlgorithmMode</a>.Research);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a9d7d63e4bdbc986d50ae5f2595da01a2" title="Sets the algorithm deployment target">SetDeploymentTarget</a>(<a class="code" href="classQuantConnect_1_1Configuration_1_1Config.html" title="Configuration class loads the required external setup variables to launch the Lean engine.">Config</a>.GetValue(<span class="stringliteral">&quot;deployment-target&quot;</span>, <a class="code" href="namespaceQuantConnect.html#abc29bce5b5b69662b3b9f7b6664707f4" title="Represents the types deployment targets for algorithms">DeploymentTarget</a>.LocalPlatform));</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">catch</span> (Exception exception)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;QuantBook.Main(): &quot;</span> + exception);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">        /// Python implementation of GetFundamental, get fundamental data for input symbols or tickers</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">        /// &lt;param name=&quot;input&quot;&gt;The symbols or tickers to retrieve fundamental data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the Fundamental data to filter the request output&lt;/param&gt;</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas DataFrame&lt;/returns&gt;</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;UniverseHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad7004b424ab264b73bd0bc0616cab54a">  221</a></span>&#160;        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad7004b424ab264b73bd0bc0616cab54a" title="Python implementation of GetFundamental, get fundamental data for input symbols or tickers">GetFundamental</a>(PyObject input, <span class="keywordtype">string</span> selector = <span class="keyword">null</span>, DateTime? start = <span class="keyword">null</span>, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="comment">//Covert to symbols</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            var symbols = <a class="code" href="classQuantConnect_1_1Util_1_1PythonUtil.html" title="Collection of utils for python objects processing">PythonUtil</a>.<a class="code" href="classQuantConnect_1_1Util_1_1PythonUtil.html#a4d0035ee91c15461d72b36e75b9d9f3a" title="Convert Python input to a list of Symbols">ConvertToSymbols</a>(input);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment">//Fetch the data</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            var fundamentalData = GetAllFundamental(symbols, selector, start, end);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keyword">using</span> (Py.GIL())</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                var data = <span class="keyword">new</span> PyDict();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordflow">foreach</span> (var day <span class="keywordflow">in</span> fundamentalData.OrderBy(x =&gt; x.Key))</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    var orderedValues = day.Value.OrderBy(x =&gt; x.Key.ID.ToString()).ToList();</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    var columns = orderedValues.Select(x =&gt; x.Key.ID.ToString());</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    var values = orderedValues.Select(x =&gt; x.Value);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    var row = _pandas.Series(values, columns);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    data.SetItem(day.Key.ToPython(), row);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">return</span> _pandas.DataFrame.from_dict(data, orient:<span class="stringliteral">&quot;index&quot;</span>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">        /// Get fundamental data from given symbols</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbols&quot;&gt;The symbols to retrieve fundamental data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the Fundamental data to filter the request output&lt;/param&gt;</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">        /// &lt;returns&gt;Enumerable collection of DataDictionaries, one dictionary for each day there is data&lt;/returns&gt;</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;UniverseHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a8263e35ea3fb1fdae88bab348b7e50bc">  254</a></span>&#160;        <span class="keyword">public</span> IEnumerable&lt;DataDictionary&lt;dynamic&gt;&gt; <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a8263e35ea3fb1fdae88bab348b7e50bc" title="Get fundamental data from given symbols">GetFundamental</a>(IEnumerable&lt;Symbol&gt; symbols, <span class="keywordtype">string</span> selector = <span class="keyword">null</span>, DateTime? start = <span class="keyword">null</span>, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            var data = GetAllFundamental(symbols, selector, start, end);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">foreach</span> (var kvp <span class="keywordflow">in</span> data.OrderBy(kvp =&gt; kvp.Key))</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                yield <span class="keywordflow">return</span> kvp.Value;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">        /// Get fundamental data for a given symbol</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve fundamental data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the Fundamental data to filter the request output&lt;/param&gt;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">        /// &lt;returns&gt;Enumerable collection of DataDictionaries, one Dictionary for each day there is data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;UniverseHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a34d04fadb83714e695855bdfec15044b">  273</a></span>&#160;        <span class="keyword">public</span> IEnumerable&lt;DataDictionary&lt;dynamic&gt;&gt; <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a34d04fadb83714e695855bdfec15044b" title="Get fundamental data for a given symbol">GetFundamental</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, <span class="keywordtype">string</span> selector = <span class="keyword">null</span>, DateTime? start = <span class="keyword">null</span>, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            var list = <span class="keyword">new</span> List&lt;Symbol&gt;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                symbol</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            };</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad7004b424ab264b73bd0bc0616cab54a" title="Python implementation of GetFundamental, get fundamental data for input symbols or tickers">GetFundamental</a>(list, selector, start, end);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">        /// Get fundamental data for a given set of tickers</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">        /// &lt;param name=&quot;tickers&quot;&gt;The tickers to retrieve fundamental data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the Fundamental data to filter the request output&lt;/param&gt;</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">        /// &lt;returns&gt;Enumerable collection of DataDictionaries, one dictionary for each day there is data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;UniverseHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a96f82865ba844e5fd533ee7a0a45098d">  292</a></span>&#160;        <span class="keyword">public</span> IEnumerable&lt;DataDictionary&lt;dynamic&gt;&gt; <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a96f82865ba844e5fd533ee7a0a45098d" title="Get fundamental data for a given set of tickers">GetFundamental</a>(IEnumerable&lt;string&gt; tickers, <span class="keywordtype">string</span> selector = <span class="keyword">null</span>, DateTime? start = <span class="keyword">null</span>, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            var list = <span class="keyword">new</span> List&lt;Symbol&gt;();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">foreach</span> (var ticker <span class="keywordflow">in</span> tickers)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                list.Add(<a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a350b9a625cf7bad95da82894be3cd0a8" title="Provides a convenience method for creating a Symbol for most security types. This method currently do...">Create</a>(ticker, <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Equity, <a class="code" href="classQuantConnect_1_1Market.html" title="Markets Collection: Soon to be expanded to a collection of items specifying the market hour,...">Market</a>.<a class="code" href="classQuantConnect_1_1Market.html#ab62a170b2945e72bfb67cb582a3d3fec" title="USA Market">USA</a>));</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad7004b424ab264b73bd0bc0616cab54a" title="Python implementation of GetFundamental, get fundamental data for input symbols or tickers">GetFundamental</a>(list, selector, start, end);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">        /// Get fundamental data for a given ticker</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve fundamental data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the Fundamental data to filter the request output&lt;/param&gt;</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">        /// &lt;returns&gt;Enumerable collection of DataDictionaries, one Dictionary for each day there is data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;UniverseHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a71f6b5b9e4d25dc5fdc4a67877aa8b37">  312</a></span>&#160;        <span class="keyword">public</span> dynamic <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a71f6b5b9e4d25dc5fdc4a67877aa8b37" title="Get fundamental data for a given ticker">GetFundamental</a>(<span class="keywordtype">string</span> ticker, <span class="keywordtype">string</span> selector = <span class="keyword">null</span>, DateTime? start = <span class="keyword">null</span>, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="comment">//Check if its Python; PythonNet likes to convert the strings, but for python we want the DataFrame as the return object</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="comment">//So we must route the function call to the Python version.</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">if</span> (_isPythonNotebook)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad7004b424ab264b73bd0bc0616cab54a" title="Python implementation of GetFundamental, get fundamental data for input symbols or tickers">GetFundamental</a>(ticker.ToPython(), selector, start, end);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            var symbol = <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a350b9a625cf7bad95da82894be3cd0a8" title="Provides a convenience method for creating a Symbol for most security types. This method currently do...">Create</a>(ticker, <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Equity, <a class="code" href="classQuantConnect_1_1Market.html" title="Markets Collection: Soon to be expanded to a collection of items specifying the market hour,...">Market</a>.<a class="code" href="classQuantConnect_1_1Market.html#ab62a170b2945e72bfb67cb582a3d3fec" title="USA Market">USA</a>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            var list = <span class="keyword">new</span> List&lt;Symbol&gt;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                symbol</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            };</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad7004b424ab264b73bd0bc0616cab54a" title="Python implementation of GetFundamental, get fundamental data for input symbols or tickers">GetFundamental</a>(list, selector, start, end);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">        /// Gets &lt;see cref=&quot;OptionHistory&quot;/&gt; object for a given symbol, date and resolution</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical option data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">        /// &lt;param name=&quot;targetOption&quot;&gt;The target option ticker. This is useful when the option ticker does not match the underlying, e.g. SPX index and the SPXW weekly option. If null is provided will use underlying&lt;/param&gt;</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The history request start time&lt;/param&gt;</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The history request end time. Defaults to 1 day if null&lt;/param&gt;</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">        /// &lt;param name=&quot;fillForward&quot;&gt;True to fill forward missing data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">        /// &lt;param name=&quot;extendedMarketHours&quot;&gt;True to include extended market hours data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">        /// &lt;returns&gt;A &lt;see cref=&quot;OptionHistory&quot;/&gt; object that contains historical option data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#af9587b46674a9a44236a5188e34a9128">  341</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Research_1_1OptionHistory.html" title="Class to manage information from History Request of Options">OptionHistory</a> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#af9587b46674a9a44236a5188e34a9128" title="Gets OptionHistory object for a given symbol, date and resolution">OptionHistory</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, <span class="keywordtype">string</span> targetOption, DateTime start, DateTime? end = <span class="keyword">null</span>, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>,</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordtype">bool</span> fillForward = <span class="keyword">true</span>, <span class="keywordtype">bool</span> extendedMarketHours = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            symbol = GetOptionSymbolForHistoryRequest(symbol, targetOption, resolution, fillForward);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#af9587b46674a9a44236a5188e34a9128" title="Gets OptionHistory object for a given symbol, date and resolution">OptionHistory</a>(symbol, start, end, resolution, fillForward, extendedMarketHours);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">        /// Gets &lt;see cref=&quot;OptionHistory&quot;/&gt; object for a given symbol, date and resolution</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical option data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">        /// &lt;param name=&quot;targetOption&quot;&gt;The target option ticker. This is useful when the option ticker does not match the underlying, e.g. SPX index and the SPXW weekly option. If null is provided will use underlying&lt;/param&gt;</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The history request start time&lt;/param&gt;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The history request end time. Defaults to 1 day if null&lt;/param&gt;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">        /// &lt;param name=&quot;fillForward&quot;&gt;True to fill forward missing data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">        /// &lt;param name=&quot;extendedMarketHours&quot;&gt;True to include extended market hours data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">        /// &lt;returns&gt;A &lt;see cref=&quot;OptionHistory&quot;/&gt; object that contains historical option data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;OptionHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#aaf0f7ae0c195e1e5e16cdaf26f2d6067">  361</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Research_1_1OptionHistory.html" title="Class to manage information from History Request of Options">OptionHistory</a> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#aaf0f7ae0c195e1e5e16cdaf26f2d6067" title="Gets OptionHistory object for a given symbol, date and resolution">GetOptionHistory</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, <span class="keywordtype">string</span> targetOption, DateTime start, DateTime? end = <span class="keyword">null</span>, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="keywordtype">bool</span> fillForward = <span class="keyword">true</span>, <span class="keywordtype">bool</span> extendedMarketHours = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#af9587b46674a9a44236a5188e34a9128" title="Gets OptionHistory object for a given symbol, date and resolution">OptionHistory</a>(symbol, targetOption, start, end, resolution, fillForward, extendedMarketHours);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">        /// Gets &lt;see cref=&quot;OptionHistory&quot;/&gt; object for a given symbol, date and resolution</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical option data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The history request start time&lt;/param&gt;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The history request end time. Defaults to 1 day if null&lt;/param&gt;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">        /// &lt;param name=&quot;fillForward&quot;&gt;True to fill forward missing data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">        /// &lt;param name=&quot;extendedMarketHours&quot;&gt;True to include extended market hours data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">        /// &lt;returns&gt;A &lt;see cref=&quot;OptionHistory&quot;/&gt; object that contains historical option data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a9c6829f944fce7f66a72fa0d9b64f7b8">  377</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Research_1_1OptionHistory.html" title="Class to manage information from History Request of Options">OptionHistory</a> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a9c6829f944fce7f66a72fa0d9b64f7b8" title="Gets OptionHistory object for a given symbol, date and resolution">OptionHistory</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, DateTime start, DateTime? end = <span class="keyword">null</span>, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>,</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            <span class="keywordtype">bool</span> fillForward = <span class="keyword">true</span>, <span class="keywordtype">bool</span> extendedMarketHours = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <span class="keywordflow">if</span> (!end.HasValue || end.Value == start)</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                end = start.AddDays(1);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="comment">// Load a canonical option Symbol if the user provides us with an underlying Symbol</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            symbol = GetOptionSymbolForHistoryRequest(symbol, <span class="keyword">null</span>, resolution, fillForward);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            IEnumerable&lt;Symbol&gt; symbols;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <span class="keywordflow">if</span> (symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#a1f3c25223fd9a7b753a4f84ece6469ab" title="Method returns true, if symbol is a derivative canonical symbol">IsCanonical</a>())</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <span class="comment">// canonical symbol, lets find the contracts</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                var option = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a6567d757b9c20c4b935d3f785676bfe3" title="Security collection is an array of the security objects such as Equities and FOREX....">Securities</a>[symbol] as <a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1Option.html" title="Option Security Object Implementation for Option Assets">Option</a>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                var resolutionToUseForUnderlying = resolution ?? <a class="code" href="classQuantConnect_1_1Data_1_1SubscriptionManager.html" title="Enumerable Subscription Management Class">SubscriptionManager</a>.<a class="code" href="classQuantConnect_1_1Data_1_1SubscriptionManager.html#a99db80445552627b0fecfab52d5b0106" title="Instance that implements ISubscriptionDataConfigService">SubscriptionDataConfigService</a></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                                       .<a class="code" href="interfaceQuantConnect_1_1Interfaces_1_1ISubscriptionDataConfigProvider.html#a29826b931901dd4e4b64515663a2073b" title="Gets a list of all registered SubscriptionDataConfig for a given Symbol if any else will return the w...">GetSubscriptionDataConfigs</a>(symbol)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                                       .GetHighestResolution();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a6567d757b9c20c4b935d3f785676bfe3" title="Security collection is an array of the security objects such as Equities and FOREX....">Securities</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityManager.html#ac53ed019a68266ecfa144ab91162b6cb" title="Check if this collection contains this symbol.">ContainsKey</a>(symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>))</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    <span class="keywordflow">if</span> (symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a4b811550395ad9af00dacee29bde4125" title="Gets the security type of the symbol">SecurityType</a> == <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Equity)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                        <span class="comment">// only add underlying if not present</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                        <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#aae4bbf25961344c2ad4ca7270966f90d" title="Creates and adds a new Equity security to the algorithm">AddEquity</a>(symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#ad77256b8d686f7e2699e040e8e703b94" title="Gets the current symbol for this ticker">Value</a>, resolutionToUseForUnderlying, fillForward: fillForward,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                            extendedMarketHours: extendedMarketHours);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a4b811550395ad9af00dacee29bde4125" title="Gets the security type of the symbol">SecurityType</a> == <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Index)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                        <span class="comment">// only add underlying if not present</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                        <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#aa8ce9c6216eb415122a462f29c5a0932" title="Creates and adds a new Index security to the algorithm">AddIndex</a>(symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#ad77256b8d686f7e2699e040e8e703b94" title="Gets the current symbol for this ticker">Value</a>, resolutionToUseForUnderlying, fillForward: fillForward);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a4b811550395ad9af00dacee29bde4125" title="Gets the security type of the symbol">SecurityType</a> == <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Future &amp;&amp; symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a1f3c25223fd9a7b753a4f84ece6469ab" title="Method returns true, if symbol is a derivative canonical symbol">IsCanonical</a>())</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                        <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#ae40bde218ca98e593a076fd671837bd4" title="Creates and adds a new Future security to the algorithm">AddFuture</a>(symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a4a251183dd32355cc0c30a9f94aeedd1" title="Gets the security identifier for this symbol">ID</a>.<a class="code" href="classQuantConnect_1_1SecurityIdentifier.html#ace258f9e4ad2c6f375838feb31c6b2ee" title="Gets the original symbol used to generate this security identifier. For equities, by convention this ...">Symbol</a>, resolutionToUseForUnderlying, fillForward: fillForward,</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                            extendedMarketHours: extendedMarketHours);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a4b811550395ad9af00dacee29bde4125" title="Gets the security type of the symbol">SecurityType</a> == <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Future)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a896e634226bc3132055e766b03890992" title="Creates and adds a new single Future contract to the algorithm">AddFutureContract</a>(symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>, resolutionToUseForUnderlying, fillForward: fillForward,</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                            extendedMarketHours: extendedMarketHours);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                    }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                var allSymbols = <span class="keyword">new</span> List&lt;Symbol&gt;();</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">for</span> (var date = start; date &lt; end; date = date.AddDays(1))</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    <span class="keywordflow">if</span> (option.Exchange.DateIsOpen(date))</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        allSymbols.AddRange(<a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#ad17a39eff331e0a209158e5a60aa8230" title="Gets the option chain provider, used to get the list of option contracts for an underlying symbol">OptionChainProvider</a>.<a class="code" href="interfaceQuantConnect_1_1Interfaces_1_1IOptionChainProvider.html#ae84aa4fcafd5bd9723724ffd4c8878ee" title="Gets the list of option contracts for a given underlying symbol">GetOptionContractList</a>(symbol, date));</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                    }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                var optionFilterUniverse = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a>(option);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                var distinctSymbols = allSymbols.Distinct();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                symbols = base.History(symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a>, start, end.<a class="code" href="classQuantConnect_1_1Symbol.html#ad77256b8d686f7e2699e040e8e703b94" title="Gets the current symbol for this ticker">Value</a>, resolution)</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    .SelectMany(x =&gt;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        <span class="comment">// the option chain symbols wont change so we can set &#39;exchangeDateChange&#39; to false always</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        optionFilterUniverse.Refresh(distinctSymbols, x, x.EndTime);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                        <span class="keywordflow">return</span> option.ContractFilter.Filter(optionFilterUniverse);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    })</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    .Distinct().Concat(<span class="keyword">new</span>[] { symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#ad7a9ba4ed860939fad35b99f748e399c" title="Gets the security underlying symbol, if any">Underlying</a> });</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="comment">// the symbol is a contract</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                symbols = <span class="keyword">new</span> List&lt;Symbol&gt;{ symbol };</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#af9587b46674a9a44236a5188e34a9128" title="Gets OptionHistory object for a given symbol, date and resolution">OptionHistory</a>(<a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(symbols, start, end.Value, resolution, fillForward, extendedMarketHours));</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">        /// Gets &lt;see cref=&quot;OptionHistory&quot;/&gt; object for a given symbol, date and resolution</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical option data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The history request start time&lt;/param&gt;</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The history request end time. Defaults to 1 day if null&lt;/param&gt;</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">        /// &lt;param name=&quot;fillForward&quot;&gt;True to fill forward missing data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">        /// &lt;param name=&quot;extendedMarketHours&quot;&gt;True to include extended market hours data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">        /// &lt;returns&gt;A &lt;see cref=&quot;OptionHistory&quot;/&gt; object that contains historical option data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;OptionHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#ac5631f432f4f61778fe4b3e0fb378d2b">  460</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Research_1_1OptionHistory.html" title="Class to manage information from History Request of Options">OptionHistory</a> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#ac5631f432f4f61778fe4b3e0fb378d2b" title="Gets OptionHistory object for a given symbol, date and resolution">GetOptionHistory</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, DateTime start, DateTime? end = <span class="keyword">null</span>, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="keywordtype">bool</span> fillForward = <span class="keyword">true</span>, <span class="keywordtype">bool</span> extendedMarketHours = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#af9587b46674a9a44236a5188e34a9128" title="Gets OptionHistory object for a given symbol, date and resolution">OptionHistory</a>(symbol, start, end, resolution, fillForward, extendedMarketHours);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">        /// Gets &lt;see cref=&quot;FutureHistory&quot;/&gt; object for a given symbol, date and resolution</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical future data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The history request start time&lt;/param&gt;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The history request end time. Defaults to 1 day if null&lt;/param&gt;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">        /// &lt;param name=&quot;fillForward&quot;&gt;True to fill forward missing data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">        /// &lt;param name=&quot;extendedMarketHours&quot;&gt;True to include extended market hours data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">        /// &lt;returns&gt;A &lt;see cref=&quot;FutureHistory&quot;/&gt; object that contains historical future data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a6481be0ce6ba2d6144f2b48272031aac">  476</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Research_1_1FutureHistory.html" title="Class to manage information from History Request of Futures">FutureHistory</a> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a6481be0ce6ba2d6144f2b48272031aac" title="Gets FutureHistory object for a given symbol, date and resolution">FutureHistory</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, DateTime start, DateTime? end = <span class="keyword">null</span>, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>,</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="keywordtype">bool</span> fillForward = <span class="keyword">true</span>, <span class="keywordtype">bool</span> extendedMarketHours = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordflow">if</span> (!end.HasValue || end.Value == start)</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                end = start.AddDays(1);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            var allSymbols = <span class="keyword">new</span> HashSet&lt;Symbol&gt;();</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">if</span> (symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#a1f3c25223fd9a7b753a4f84ece6469ab" title="Method returns true, if symbol is a derivative canonical symbol">IsCanonical</a>())</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <span class="comment">// canonical symbol, lets find the contracts</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                var future = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a6567d757b9c20c4b935d3f785676bfe3" title="Security collection is an array of the security objects such as Equities and FOREX....">Securities</a>[symbol] as <a class="code" href="classQuantConnect_1_1Securities_1_1Future_1_1Future.html" title="Futures Security Object Implementation for Futures Assets">Future</a>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">for</span> (var date = start; date &lt; end; date = date.AddDays(1))</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                    <span class="keywordflow">if</span> (future.Exchange.DateIsOpen(date))</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                    {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                        var allList = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a2f6352969554c2a126a29b0a89517875" title="Gets the future chain provider, used to get the list of future contracts for an underlying symbol">FutureChainProvider</a>.<a class="code" href="interfaceQuantConnect_1_1Interfaces_1_1IFutureChainProvider.html#a4aab3e63f1d04226c253a9e5895d76d8" title="Gets the list of future contracts for a given underlying symbol">GetFutureContractList</a>(future.Symbol, date);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                        allSymbols.UnionWith(future.ContractFilter.Filter(<span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Securities_1_1FutureFilterUniverse.html" title="Represents futures symbols universe used in filtering.">FutureFilterUniverse</a>(allList, date)));</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="comment">// the symbol is a contract</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                allSymbols.Add(symbol);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a6481be0ce6ba2d6144f2b48272031aac" title="Gets FutureHistory object for a given symbol, date and resolution">FutureHistory</a>(<a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(allSymbols, start, end.Value, resolution, fillForward, extendedMarketHours));</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">        /// Gets &lt;see cref=&quot;FutureHistory&quot;/&gt; object for a given symbol, date and resolution</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical future data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The history request start time&lt;/param&gt;</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The history request end time. Defaults to 1 day if null&lt;/param&gt;</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">        /// &lt;param name=&quot;fillForward&quot;&gt;True to fill forward missing data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">        /// &lt;param name=&quot;extendedMarketHours&quot;&gt;True to include extended market hours data, false otherwise&lt;/param&gt;</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">        /// &lt;returns&gt;A &lt;see cref=&quot;FutureHistory&quot;/&gt; object that contains historical future data.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Please use the &#39;FutureHistory()&#39; API&quot;</span>)]</div>
<div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a3314fb10c220a0bad1dbe889038b389d">  520</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Research_1_1FutureHistory.html" title="Class to manage information from History Request of Futures">FutureHistory</a> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a3314fb10c220a0bad1dbe889038b389d" title="Gets FutureHistory object for a given symbol, date and resolution">GetFutureHistory</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, DateTime start, DateTime? end = <span class="keyword">null</span>, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>,</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <span class="keywordtype">bool</span> fillForward = <span class="keyword">true</span>, <span class="keywordtype">bool</span> extendedMarketHours = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a6481be0ce6ba2d6144f2b48272031aac" title="Gets FutureHistory object for a given symbol, date and resolution">FutureHistory</a>(symbol, start, end, resolution, fillForward, extendedMarketHours);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">        /// Gets the historical data of an indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">        /// &lt;param name=&quot;periods&quot;&gt;The number of bars to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of an indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267">  535</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;IndicatorDataPoint&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, <span class="keywordtype">int</span> period, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, decimal&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, period, resolution);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">        /// Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">        /// &lt;param name=&quot;periods&quot;&gt;The number of bars to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of a bar indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#af1def6e8bdfcec2c81f0bc3d4b150d3d">  550</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#af1def6e8bdfcec2c81f0bc3d4b150d3d" title="Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will b...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;IBaseDataBar&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, <span class="keywordtype">int</span> period, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, IBaseDataBar&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, period, resolution);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">        /// Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">        /// &lt;param name=&quot;periods&quot;&gt;The number of bars to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of a bar indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#acf21986cd1ba2747f042019b31fcc3d2">  565</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#acf21986cd1ba2747f042019b31fcc3d2" title="Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will b...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;TradeBar&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, <span class="keywordtype">int</span> period, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, TradeBar&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, period, resolution);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">        /// Gets the historical data of an indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">        /// &lt;param name=&quot;span&quot;&gt;The span over which to retrieve recent historical data&lt;/param&gt;</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of an indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a6abedef3e6dc5293a5b0327e475f9341">  581</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a6abedef3e6dc5293a5b0327e475f9341" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;IndicatorDataPoint&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, TimeSpan span, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, decimal&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, span, resolution);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">        /// Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">        /// &lt;param name=&quot;span&quot;&gt;The span over which to retrieve recent historical data&lt;/param&gt;</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of a bar indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00597"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a13de412d3af96714e46c6e46861fdf1b">  597</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a13de412d3af96714e46c6e46861fdf1b" title="Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will b...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;IBaseDataBar&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, TimeSpan span, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, IBaseDataBar&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, span, resolution);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">        /// Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">        /// &lt;param name=&quot;span&quot;&gt;The span over which to retrieve recent historical data&lt;/param&gt;</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of a bar indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00613"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a5413dd7849197b0011ea74243cc9fff5">  613</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a5413dd7849197b0011ea74243cc9fff5" title="Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will b...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;TradeBar&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, TimeSpan span, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, TradeBar&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, span, resolution);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">        /// Gets the historical data of an indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start time in the algorithm&#39;s time zone&lt;/param&gt;</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end time in the algorithm&#39;s time zone&lt;/param&gt;</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of an indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00630"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#aa701bc2373fbfbbcd3e7a7ae2bb28d84">  630</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#aa701bc2373fbfbbcd3e7a7ae2bb28d84" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;IndicatorDataPoint&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, DateTime start, DateTime end, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, decimal&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, start, end, resolution);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">        /// Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start time in the algorithm&#39;s time zone&lt;/param&gt;</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end time in the algorithm&#39;s time zone&lt;/param&gt;</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of a bar indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#afffd78becb87c2ef9f9b1696943e5355">  647</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#afffd78becb87c2ef9f9b1696943e5355" title="Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will b...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;IBaseDataBar&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, DateTime start, DateTime end, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, IBaseDataBar&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, start, end, resolution);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">        /// Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will be returned.</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">        /// The symbol must exist in the Securities collection.</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbol&quot;&gt;The symbol to retrieve historical data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start time in the algorithm&#39;s time zone&lt;/param&gt;</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end time in the algorithm&#39;s time zone&lt;/param&gt;</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">        /// &lt;param name=&quot;resolution&quot;&gt;The resolution to request&lt;/param&gt;</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame of historical data of a bar indicator&lt;/returns&gt;</span></div>
<div class="line"><a name="l00664"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad6a7329859cd4188b93a68087f1973c0">  664</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#ad6a7329859cd4188b93a68087f1973c0" title="Gets the historical data of a bar indicator for the specified symbol. The exact number of bars will b...">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;TradeBar&gt;</a> indicator, <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol, DateTime start, DateTime end, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution = <span class="keyword">null</span>, Func&lt;IBaseData, TradeBar&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(<span class="keyword">new</span>[] { symbol }, start, end, resolution);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a747396d92fd76ab74282e6e983dc5267" title="Gets the historical data of an indicator for the specified symbol. The exact number of bars will be r...">Indicator</a>(indicator, history, selector);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">        /// Will return the universe selection data and will optionally perform selection</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">        /// &lt;typeparam name=&quot;T1&quot;&gt;The universe selection universe data type, for example Fundamentals&lt;/typeparam&gt;</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">        /// &lt;typeparam name=&quot;T2&quot;&gt;The selection data type, for example Fundamental&lt;/typeparam&gt;</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date&lt;/param&gt;</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;Optionally the end date, will default to today&lt;/param&gt;</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">        /// &lt;param name=&quot;func&quot;&gt;Optionally the universe selection function&lt;/param&gt;</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">        /// &lt;returns&gt;Enumerable of universe selection data for each date, filtered if the func was provided&lt;/returns&gt;</span></div>
<div class="line"><a name="l00679"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#af4316bb657e567356fb681daf4ebb0e5">  679</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> IEnumerable&lt;IEnumerable&lt;T2&gt;&gt; <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#af4316bb657e567356fb681daf4ebb0e5" title="Will return the universe selection data and will optionally perform selection">UniverseHistory&lt;T1, T2&gt;</a>(DateTime start, DateTime? end = <span class="keyword">null</span>, Func&lt;IEnumerable&lt;T2&gt;, IEnumerable&lt;Symbol&gt;&gt; func = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            where T1 : <a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1BaseDataCollection.html" title="This type exists for transport of data as a single packet">BaseDataCollection</a></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            where T2 : <a class="code" href="interfaceQuantConnect_1_1Data_1_1IBaseData.html" title="Base Data Class: Type, Timestamp, Key  Base Features.">IBaseData</a></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            var universeSymbol = ((<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1BaseDataCollection.html" title="This type exists for transport of data as a single packet">BaseDataCollection</a>)typeof(T1).GetBaseDataInstance()).UniverseSymbol();</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            var symbols = <span class="keyword">new</span>[] { universeSymbol };</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            var requests = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a3dbba29e9f318ae97e8b99a1eb19537c" title="Helper method to create history requests from a date range">CreateDateRangeHistoryRequests</a>(<span class="keyword">new</span>[] { universeSymbol }, typeof(T1), start, end ?? DateTime.UtcNow.Date);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            var history = GetDataTypedHistory&lt;BaseDataCollection&gt;(requests).Select(x =&gt; x.Values.Single());</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            HashSet&lt;Symbol&gt; filteredSymbols = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="keywordflow">foreach</span> (var data <span class="keywordflow">in</span> history)</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                var castedType = data.Data.OfType&lt;T2&gt;();</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                <span class="keywordflow">if</span> (func != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                    var selection = func(castedType);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    <span class="keywordflow">if</span> (!ReferenceEquals(selection, <a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html" title="Provides a base class for all universes to derive from.">Universe</a>.<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html#a90115b67831b6f1ee4b46969597346c7" title="Gets a value indicating that no change to the universe should be made">Unchanged</a>))</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                    {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        filteredSymbols = selection.ToHashSet();</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                    }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                    yield <span class="keywordflow">return</span> castedType.Where(x =&gt; filteredSymbols == <span class="keyword">null</span> || filteredSymbols.Contains(x.Symbol));</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                    yield <span class="keywordflow">return</span> castedType;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">        /// Will return the universe selection data and will optionally perform selection</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;The universe to fetch the data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date&lt;/param&gt;</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;Optionally the end date, will default to today&lt;/param&gt;</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">        /// &lt;returns&gt;Enumerable of universe selection data for each date, filtered if the func was provided&lt;/returns&gt;</span></div>
<div class="line"><a name="l00717"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a705d66c4f94871550ca5b2102d341c89">  717</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> IEnumerable&lt;IEnumerable&lt;BaseData&gt;&gt; <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a705d66c4f94871550ca5b2102d341c89" title="Will return the universe selection data and will optionally perform selection">UniverseHistory</a>(<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html" title="Provides a base class for all universes to derive from.">Universe</a> universe, DateTime start, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keywordflow">return</span> RunUniverseSelection(universe, start, end);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">        /// Will return the universe selection data and will optionally perform selection</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;The universe to fetch the data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date&lt;/param&gt;</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;Optionally the end date, will default to today&lt;/param&gt;</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">        /// &lt;param name=&quot;func&quot;&gt;Optionally the universe selection function&lt;/param&gt;</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">        /// &lt;returns&gt;Enumerable of universe selection data for each date, filtered if the func was provided&lt;/returns&gt;</span></div>
<div class="line"><a name="l00730"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#a9b163fba5abad084fdc193ca3d81af76">  730</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyObject <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#a9b163fba5abad084fdc193ca3d81af76" title="Will return the universe selection data and will optionally perform selection">UniverseHistory</a>(PyObject universe, DateTime start, DateTime? end = <span class="keyword">null</span>, PyObject func = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keywordflow">if</span> (universe.TryConvert&lt;<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html" title="Provides a base class for all universes to derive from.">Universe</a>&gt;(out var convertedUniverse))</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                <span class="keywordflow">if</span> (func != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException($<span class="stringliteral">&quot;When providing a universe, the selection func argument isn&#39;t supported. Please provider a universe or a type and a func&quot;</span>);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                var filteredUniverseSelectionData = RunUniverseSelection(convertedUniverse, start, end);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="keywordflow">return</span> GetDataFrame(filteredUniverseSelectionData);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            <span class="comment">// for backwards compatibility</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="keywordflow">if</span> (universe.TryConvert&lt;Type&gt;(out var convertedType) &amp;&amp; convertedType.IsAssignableTo(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1BaseDataCollection.html" title="This type exists for transport of data as a single packet">BaseDataCollection</a>)))</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                end ??= DateTime.UtcNow.Date;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                var universeSymbol = ((<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1BaseDataCollection.html" title="This type exists for transport of data as a single packet">BaseDataCollection</a>)convertedType.GetBaseDataInstance()).UniverseSymbol();</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                <span class="keywordflow">if</span> (func == <span class="keyword">null</span>)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(universe, universeSymbol, start, end.Value);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                var requests = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a3dbba29e9f318ae97e8b99a1eb19537c" title="Helper method to create history requests from a date range">CreateDateRangeHistoryRequests</a>(<span class="keyword">new</span>[] { universeSymbol }, convertedType, start, end.Value);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                var history = <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a446a10e68319fdc3c0b2ed85d80f55f8" title="Get the history for all configured securities over the requested span. This will use the resolution a...">History</a>(requests);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                <span class="keywordflow">return</span> GetDataFrame(GetFilteredSlice(history, func), convertedType);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException($<span class="stringliteral">&quot;Failed to convert given universe {universe}. Please provider a valid {nameof(Universe)}&quot;</span>);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">        /// Gets Portfolio Statistics from a pandas.DataFrame with equity and benchmark values</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">        /// &lt;param name=&quot;dataFrame&quot;&gt;pandas.DataFrame with the information required to compute the Portfolio statistics&lt;/param&gt;</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;see cref=&quot;PortfolioStatistics&quot;/&gt; object wrapped in a &lt;see cref=&quot;PyDict&quot;/&gt; with the portfolio statistics.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00766"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Research_1_1QuantBook.html#acc952b95b6ed92fcda35790943857348">  766</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> PyDict <a class="code" href="classQuantConnect_1_1Research_1_1QuantBook.html#acc952b95b6ed92fcda35790943857348" title="Gets Portfolio Statistics from a pandas.DataFrame with equity and benchmark values">GetPortfolioStatistics</a>(PyObject dataFrame)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            var dictBenchmark = <span class="keyword">new</span> SortedDictionary&lt;DateTime, double&gt;();</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            var dictEquity = <span class="keyword">new</span> SortedDictionary&lt;DateTime, double&gt;();</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            var dictPL = <span class="keyword">new</span> SortedDictionary&lt;DateTime, double&gt;();</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="keyword">using</span> (Py.GIL())</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                var result = <span class="keyword">new</span> PyDict();</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                <span class="keywordflow">try</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                    <span class="comment">// Converts the data from pandas.DataFrame into dictionaries keyed by time</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                    var df = ((dynamic)dataFrame).dropna();</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                    dictBenchmark = GetDictionaryFromSeries((PyObject)df[<span class="stringliteral">&quot;benchmark&quot;</span>]);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                    dictEquity = GetDictionaryFromSeries((PyObject)df[<span class="stringliteral">&quot;equity&quot;</span>]);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                    dictPL = GetDictionaryFromSeries((PyObject)df[<span class="stringliteral">&quot;equity&quot;</span>].pct_change());</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                <span class="keywordflow">catch</span> (PythonException e)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                    result.SetItem(<span class="stringliteral">&quot;Runtime Error&quot;</span>, e.Message.ToPython());</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                <span class="comment">// Convert the double into decimal</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                var equity = <span class="keyword">new</span> SortedDictionary&lt;DateTime, decimal&gt;(dictEquity.ToDictionary(kvp =&gt; kvp.Key, kvp =&gt; (decimal)kvp.Value));</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                var profitLoss = <span class="keyword">new</span> SortedDictionary&lt;DateTime, decimal&gt;(dictPL.ToDictionary(kvp =&gt; kvp.Key, kvp =&gt; <span class="keywordtype">double</span>.IsNaN(kvp.Value) ? 0 : (decimal)kvp.Value));</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                <span class="comment">// Gets the last value of the day of the benchmark and equity</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                var listBenchmark = CalculateDailyRateOfChange(dictBenchmark);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                var listPerformance = CalculateDailyRateOfChange(dictEquity);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                <span class="comment">// Gets the startting capital</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                var startingCapital = Convert.ToDecimal(dictEquity.FirstOrDefault().Value);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                <span class="comment">// call method to set tradingDayPerYear for Algorithm (use: backwards compatibility)</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                <a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1Setup_1_1BaseSetupHandler.html" title="Base class that provides shared code for the ISetupHandler implementations">BaseSetupHandler</a>.<a class="code" href="classQuantConnect_1_1Lean_1_1Engine_1_1Setup_1_1BaseSetupHandler.html#a700f98e4cf6add8654078dc4f304afd0" title="Set the number of trading days per year based on the specified brokerage model.">SetBrokerageTradingDayPerYear</a>(algorithm: <span class="keyword">this</span>);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                <span class="comment">// Compute portfolio statistics</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                var stats = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Statistics_1_1PortfolioStatistics.html" title="The PortfolioStatistics class represents a set of statistics calculated from equity and benchmark sam...">PortfolioStatistics</a>(profitLoss, equity, <span class="keyword">new</span>(), listPerformance, listBenchmark, startingCapital, <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#af39cc67f174e37f86383d92d44bb6a79" title="Gets the risk free interest rate model used to get the interest rates">RiskFreeInterestRateModel</a>,</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                    <a class="code" href="classQuantConnect_1_1Algorithm_1_1QCAlgorithm.html#a499c1abc3c9d67c770b5265db5eddb8f" title="Gets the user settings for the algorithm">Settings</a>.<a class="code" href="interfaceQuantConnect_1_1Interfaces_1_1IAlgorithmSettings.html#ad901b63eb40831293a082e066a868e00" title="Gets or sets the number of trading days per year for this Algorithm&#39;s portfolio statistics.">TradingDaysPerYear</a>.Value);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Average Win (%)&quot;</span>, Convert.ToDouble(stats.AverageWinRate * 100).ToPython());</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Average Loss (%)&quot;</span>, Convert.ToDouble(stats.AverageLossRate * 100).ToPython());</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Compounding Annual Return (%)&quot;</span>, Convert.ToDouble(stats.CompoundingAnnualReturn * 100m).ToPython());</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Drawdown (%)&quot;</span>, Convert.ToDouble(stats.Drawdown * 100).ToPython());</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Expectancy&quot;</span>, Convert.ToDouble(stats.Expectancy).ToPython());</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Net Profit (%)&quot;</span>, Convert.ToDouble(stats.TotalNetProfit * 100).ToPython());</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Sharpe Ratio&quot;</span>, Convert.ToDouble(stats.SharpeRatio).ToPython());</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Win Rate (%)&quot;</span>, Convert.ToDouble(stats.WinRate * 100).ToPython());</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Loss Rate (%)&quot;</span>, Convert.ToDouble(stats.LossRate * 100).ToPython());</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Profit-Loss Ratio&quot;</span>, Convert.ToDouble(stats.ProfitLossRatio).ToPython());</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Alpha&quot;</span>, Convert.ToDouble(stats.Alpha).ToPython());</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Beta&quot;</span>, Convert.ToDouble(stats.Beta).ToPython());</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Annual Standard Deviation&quot;</span>, Convert.ToDouble(stats.AnnualStandardDeviation).ToPython());</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Annual Variance&quot;</span>, Convert.ToDouble(stats.AnnualVariance).ToPython());</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Information Ratio&quot;</span>, Convert.ToDouble(stats.InformationRatio).ToPython());</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Tracking Error&quot;</span>, Convert.ToDouble(stats.TrackingError).ToPython());</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                result.SetItem(<span class="stringliteral">&quot;Treynor Ratio&quot;</span>, Convert.ToDouble(stats.TreynorRatio).ToPython());</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">        /// Helper method to perform selection on the given data and filter it</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> IEnumerable&lt;Slice&gt; GetFilteredSlice(IEnumerable&lt;Slice&gt; history, dynamic func)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            HashSet&lt;Symbol&gt; filteredSymbols = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="keywordflow">foreach</span> (var slice <span class="keywordflow">in</span> history)</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                var filteredData = slice.AllData.OfType&lt;<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1BaseDataCollection.html" title="This type exists for transport of data as a single packet">BaseDataCollection</a>&gt;();</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                <span class="keyword">using</span> (Py.GIL())</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                    <span class="keyword">using</span> PyObject selection = func(filteredData.SelectMany(baseData =&gt; baseData.Data));</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                    <span class="keywordflow">if</span> (!selection.TryConvert&lt;<span class="keywordtype">object</span>&gt;(out var result) || !ReferenceEquals(result, <a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html" title="Provides a base class for all universes to derive from.">Universe</a>.<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html#a90115b67831b6f1ee4b46969597346c7" title="Gets a value indicating that no change to the universe should be made">Unchanged</a>))</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                    {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                        filteredSymbols = ((<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a>[])selection.AsManagedObject(typeof(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a>[]))).ToHashSet();</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                    }</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                yield <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Data_1_1Slice.html" title="Provides a data structure for all of an algorithm&#39;s data at a single time step">Slice</a>(slice.Time, filteredData.Where(x =&gt; {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                    if (filteredSymbols == null)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                    {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                        return true;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                    }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                    x.Data = <span class="keyword">new</span> List&lt;BaseData&gt;(x.Data.Where(dataPoint =&gt; filteredSymbols.Contains(dataPoint.Symbol)));</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                }), slice.UtcTime);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">        /// Helper method to perform selection on the given data and filter it using the given universe</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> IEnumerable&lt;BaseDataCollection&gt; RunUniverseSelection(<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html" title="Provides a base class for all universes to derive from.">Universe</a> universe, DateTime start, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            var history = <a class="code" href="namespaceQuantConnect.html#abbad02007d97da37e50e4b8cb8b52151a16d2b386b2034b9488996466aaae0b57" title="History status update (11)">History</a>(universe, start, end ?? DateTime.UtcNow.Date);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            HashSet&lt;Symbol&gt; filteredSymbols = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keywordflow">foreach</span> (var dataPoint <span class="keywordflow">in</span> history)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                var utcTime = dataPoint.EndTime.ConvertToUtc(universe.<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html#a6ad4f2ad9689b621c35a74142301cb66" title="Gets the configuration used to get universe data">Configuration</a>.<a class="code" href="classQuantConnect_1_1Data_1_1SubscriptionDataConfig.html#a531bbfdc031cb061261cbf8bce385b2f" title="Gets the exchange time zone for this subscription">ExchangeTimeZone</a>);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                var selection = universe.<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html#abe22506a629447a0182d69dbc98c8644" title="Performs universe selection using the data specified">SelectSymbols</a>(utcTime, dataPoint);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="keywordflow">if</span> (!ReferenceEquals(selection, <a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html" title="Provides a base class for all universes to derive from.">Universe</a>.<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1Universe.html#a90115b67831b6f1ee4b46969597346c7" title="Gets a value indicating that no change to the universe should be made">Unchanged</a>))</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                    filteredSymbols = selection.ToHashSet();</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                dataPoint.Data = dataPoint.Data.Where(x =&gt; filteredSymbols == <span class="keyword">null</span> || filteredSymbols.Contains(x.Symbol)).ToList();</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                yield <span class="keywordflow">return</span> dataPoint;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">        /// Converts a pandas.Series into a &lt;see cref=&quot;SortedDictionary{DateTime, Double}&quot;/&gt;</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">        /// &lt;param name=&quot;series&quot;&gt;pandas.Series to be converted&lt;/param&gt;</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;see cref=&quot;SortedDictionary{DateTime, Double}&quot;/&gt; with pandas.Series information&lt;/returns&gt;</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> SortedDictionary&lt;DateTime, double&gt; GetDictionaryFromSeries(PyObject series)</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            var dictionary = <span class="keyword">new</span> SortedDictionary&lt;DateTime, double&gt;();</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            var pyDict = <span class="keyword">new</span> PyDict(((dynamic)series).to_dict());</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <span class="keywordflow">foreach</span> (PyObject item <span class="keywordflow">in</span> pyDict.Items())</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                var key = (DateTime)item[0].AsManagedObject(typeof(DateTime));</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                var value = (double)item[1].AsManagedObject(typeof(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                dictionary.Add(key, value);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            <span class="keywordflow">return</span> dictionary;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">        /// Calculates the daily rate of change</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">        /// &lt;param name=&quot;dictionary&quot;&gt;&lt;see cref=&quot;IDictionary{DateTime, Double}&quot;/&gt; with prices keyed by time&lt;/param&gt;</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;see cref=&quot;List{Double}&quot;/&gt; with daily rate of change&lt;/returns&gt;</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> List&lt;double&gt; CalculateDailyRateOfChange(IDictionary&lt;DateTime, double&gt; dictionary)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            var daily = dictionary.GroupBy(kvp =&gt; kvp.Key.Date)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                .ToDictionary(x =&gt; x.Key, v =&gt; v.LastOrDefault().Value)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                .Values.ToArray();</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            var rocp = <span class="keyword">new</span> <span class="keywordtype">double</span>[daily.Length];</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            <span class="keywordflow">for</span> (var i = 1; i &lt; daily.Length; i++)</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                rocp[i] = (daily[i] - daily[i - 1]) / daily[i - 1];</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            rocp[0] = 0;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            <span class="keywordflow">return</span> rocp.ToList();</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">        /// Gets the historical data of an indicator and convert it into pandas.DataFrame</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">        /// &lt;param name=&quot;history&quot;&gt;Historical data used to calculate the indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame containing the historical data of &lt;param name=&quot;indicator&quot;&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> PyObject <a class="code" href="classQuantConnect_1_1Indicators_1_1Indicator.html" title="Represents a type capable of ingesting a piece of data and producing a new piece of data....">Indicator</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;IndicatorDataPoint&gt;</a> indicator, IEnumerable&lt;Slice&gt; history, Func&lt;IBaseData, decimal&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            var properties = WireIndicatorProperties(indicator);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            selector = selector ?? (x =&gt; x.Value);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            history.PushThrough(bar =&gt;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                var value = selector(bar);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                indicator.Update(bar.EndTime, value);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            });</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="keywordflow">return</span> PandasConverter.GetIndicatorDataFrame(properties);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">        /// Gets the historical data of an bar indicator and convert it into pandas.DataFrame</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">        /// &lt;param name=&quot;indicator&quot;&gt;Bar indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">        /// &lt;param name=&quot;history&quot;&gt;Historical data used to calculate the indicator&lt;/param&gt;</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">        /// &lt;param name=&quot;selector&quot;&gt;Selects a value from the BaseData to send into the indicator, if null defaults to the Value property of BaseData (x =&gt; x.Value)&lt;/param&gt;</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">        /// &lt;returns&gt;pandas.DataFrame containing the historical data of &lt;param name=&quot;indicator&quot;&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> PyObject <a class="code" href="classQuantConnect_1_1Indicators_1_1Indicator.html" title="Represents a type capable of ingesting a piece of data and producing a new piece of data....">Indicator&lt;T&gt;</a>(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html">IndicatorBase&lt;T&gt;</a> indicator, IEnumerable&lt;Slice&gt; history, Func&lt;IBaseData, T&gt; selector = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            where T : <a class="code" href="interfaceQuantConnect_1_1Data_1_1IBaseData.html" title="Base Data Class: Type, Timestamp, Key  Base Features.">IBaseData</a></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            var properties = WireIndicatorProperties(indicator);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            selector = selector ?? (x =&gt; (T)x);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            history.PushThrough(bar =&gt; indicator.Update(selector(bar)));</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            <span class="keywordflow">return</span> PandasConverter.GetIndicatorDataFrame(properties);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        }</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">        /// Gets a value of a property</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">        /// &lt;param name=&quot;baseData&quot;&gt;Object with the desired property&lt;/param&gt;</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">        /// &lt;param name=&quot;fullName&quot;&gt;Property name&lt;/param&gt;</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">        /// &lt;returns&gt;Property value&lt;/returns&gt;</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> <span class="keywordtype">object</span> GetPropertyValue(<span class="keywordtype">object</span> baseData, <span class="keywordtype">string</span> fullName)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">foreach</span> (var name <span class="keywordflow">in</span> fullName.Split(<span class="charliteral">&#39;.&#39;</span>))</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                <span class="keywordflow">if</span> (baseData == <span class="keyword">null</span>) <span class="keywordflow">return</span> <span class="keyword">null</span>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                <span class="comment">// TODO this is expensive and can be cached</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                var info = baseData.GetType().GetProperty(name);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                baseData = info?.GetValue(baseData, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            }</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <span class="keywordflow">return</span> baseData;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">        /// Get all fundamental data for given symbols</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbols&quot;&gt;The symbols to retrieve fundamental data for&lt;/param&gt;</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">        /// &lt;param name=&quot;start&quot;&gt;The start date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">        /// &lt;param name=&quot;end&quot;&gt;The end date of selected data&lt;/param&gt;</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">        /// &lt;returns&gt;DataDictionary of Enumerable IBaseData&lt;/returns&gt;</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> Dictionary&lt;DateTime, DataDictionary&lt;dynamic&gt;&gt; GetAllFundamental(IEnumerable&lt;Symbol&gt; symbols, <span class="keywordtype">string</span> selector, DateTime? start = <span class="keyword">null</span>, DateTime? end = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="comment">//SubscriptionRequest does not except nullable DateTimes, so set a startTime and endTime</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            var startTime = start.HasValue ? (DateTime)start : <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="classQuantConnect_1_1Time.html" title="Time helper class collection for working with trading dates">Time</a>.<a class="code" href="classQuantConnect_1_1Time.html#a07368b7aced100010c931ca93ef4c510" title="Provides a common and normalized start time for Lean data">Start</a>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            var endTime = end.HasValue ? (DateTime) end : DateTime.UtcNow.Date;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            <span class="comment">//Collection to store our results</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            var data = <span class="keyword">new</span> Dictionary&lt;DateTime, DataDictionary&lt;dynamic&gt;&gt;();</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="comment">//Get all data for each symbol and fill our dictionary</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            <span class="keywordflow">foreach</span> (var symbol <span class="keywordflow">in</span> symbols)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                var exchangeHours = <a class="code" href="classQuantConnect_1_1Securities_1_1MarketHoursDatabase.html" title="Provides access to exchange hours and raw data times zones in various markets">MarketHoursDatabase</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1MarketHoursDatabase.html#ab10d5242b6fcbe4d9f7aacd800e0efea" title="Convenience method for retrieving exchange hours from market hours database using a subscription conf...">GetExchangeHours</a>(symbol.ID.Market, symbol, symbol.SecurityType);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                <span class="keywordflow">foreach</span> (var date <span class="keywordflow">in</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="classQuantConnect_1_1Time.html" title="Time helper class collection for working with trading dates">Time</a>.<a class="code" href="classQuantConnect_1_1Time.html#a273e34dea37136297d376a85e31be3ac" title="Define an enumerable date range of tradeable dates but expressed in a different time zone.">EachTradeableDayInTimeZone</a>(exchangeHours, startTime, endTime, TimeZones.NewYork))</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                    var currentData = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Data_1_1Fundamental_1_1Fundamental.html" title="Lean fundamental data class">Fundamental</a>(date, symbol);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                    var time = currentData.EndTime;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                    <span class="keywordtype">object</span> dataPoint = currentData;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                    <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrWhiteSpace(selector))</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                    {</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                        dataPoint = GetPropertyValue(currentData, selector);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1BaseFundamentalDataProvider.html" title="Base fundamental data provider">BaseFundamentalDataProvider</a>.<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1BaseFundamentalDataProvider.html#a034fa190537c61e409d68b8cc081b8f4" title="True if the given value is none">IsNone</a>(dataPoint))</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                        {</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                            dataPoint = <span class="keyword">null</span>;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                        }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                    }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                    <span class="keywordflow">if</span> (!data.TryGetValue(time, out var dataAtTime))</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                    {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                        dataAtTime = data[time] = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1DataDictionary.html" title="Provides a base class for types holding base data instances keyed by symbol">DataDictionary&lt;dynamic&gt;</a>(time);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                    }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                    dataAtTime.Add(currentData.Symbol, dataPoint);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            <span class="keywordflow">return</span> data;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keyword">private</span> Symbol GetOptionSymbolForHistoryRequest(Symbol symbol, <span class="keywordtype">string</span> targetOption, <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>? resolution, <span class="keywordtype">bool</span> fillForward)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            <span class="comment">// Load a canonical option Symbol if the user provides us with an underlying Symbol</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            <span class="keywordflow">if</span> (!symbol.SecurityType.IsOption())</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                var option = AddOption(symbol, targetOption,  resolution, symbol.ID.Market, fillForward);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160; </div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                <span class="comment">// Allow 20 strikes from the money for futures. No expiry filter is applied</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                <span class="comment">// so that any future contract provided will have data returned.</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                <span class="keywordflow">if</span> (symbol.SecurityType == <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Future &amp;&amp; symbol.IsCanonical())</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                {</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;The Future Symbol provided is a canonical Symbol (i.e. a Symbol representing all Futures), which is not supported at this time. &quot;</span> +</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                        <span class="stringliteral">&quot;If you are using the Symbol accessible from `AddFuture(...)`, use the Symbol from `AddFutureContract(...)` instead. &quot;</span> +</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                        <span class="stringliteral">&quot;You can use `qb.FutureOptionChainProvider(canonicalFuture, datetime)` to get a list of futures contracts for a given date, and add them to your algorithm with `AddFutureContract(symbol, Resolution)`.&quot;</span>);</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                <span class="keywordflow">if</span> (symbol.SecurityType == <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Future &amp;&amp; !symbol.IsCanonical())</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                    option.SetFilter(universe =&gt; universe.Strikes(-10, +10));</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                }</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                symbol = option.Symbol;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keywordflow">return</span> symbol;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        }</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keyword">private</span> Dictionary&lt;string, List&lt;IndicatorDataPoint&gt;&gt; WireIndicatorProperties(<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorBase.html" title="Abstract Indicator base, meant to contain non-generic fields of indicator base to support non-typed i...">IndicatorBase</a> indicator)</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <span class="comment">// Reset the indicator</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            indicator.Reset();</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <span class="comment">// Create a dictionary of the properties</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            var name = indicator.GetType().Name;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            var properties = indicator.GetType().GetProperties()</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                .Where(x =&gt; x.PropertyType.IsGenericType &amp;&amp; x.Name != <span class="stringliteral">&quot;Consolidators&quot;</span> &amp;&amp; x.Name != <span class="stringliteral">&quot;Window&quot;</span>)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                .ToDictionary(x =&gt; x.Name, y =&gt; <span class="keyword">new</span> List&lt;IndicatorDataPoint&gt;());</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            properties.Add(name, <span class="keyword">new</span> List&lt;IndicatorDataPoint&gt;());</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160; </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            indicator.Updated += (s, e) =&gt;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            {</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                <span class="keywordflow">if</span> (!indicator.IsReady)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                }</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160; </div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                <span class="keywordflow">foreach</span> (var kvp <span class="keywordflow">in</span> properties)</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                {</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                    var dataPoint = kvp.Key == name ? e : GetPropertyValue(s, kvp.Key + <span class="stringliteral">&quot;.Current&quot;</span>);</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                    kvp.Value.Add((<a class="code" href="classQuantConnect_1_1Indicators_1_1IndicatorDataPoint.html" title="Represents a piece of data at a specific time">IndicatorDataPoint</a>)dataPoint);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                }</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            };</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="keywordflow">return</span> properties;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        }</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> RecycleMemory()</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            Task.Delay(TimeSpan.FromSeconds(20)).ContinueWith(_ =&gt;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                <span class="keywordflow">if</span> (Logging.Log.DebuggingEnabled)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    Logging.Log.Debug($<span class="stringliteral">&quot;QuantBook.RecycleMemory(): running...&quot;</span>);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                }</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                GC.Collect();</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                RecycleMemory();</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            }, TaskScheduler.Current);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_35bd54ab8cf9fae74bbd2121e6bf6281.html">Research</a></li><li class="navelem"><b>QuantBook.cs</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
