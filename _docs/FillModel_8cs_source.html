<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lean: Common/Orders/Fills/FillModel.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lean
   &#160;<span id="projectnumber">$LEAN_TAG$</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('FillModel_8cs_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">FillModel.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * QUANTCONNECT.COM - Democratizing Finance, Empowering Individuals.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Lean Algorithmic Trading Engine v2.0. Copyright 2014 QuantConnect Corporation.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * limitations under the License.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">using</span> System.Linq;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Data.html">Data</a>.<a class="code" href="namespaceQuantConnect_1_1Data_1_1Market.html">Market</a>;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Python.html">Python</a>;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Orders.html">Orders</a>.<a class="code" href="namespaceQuantConnect_1_1Orders_1_1Fees.html">Fees</a>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Securities.html">Securities</a>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Util.html">Util</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceQuantConnect_1_1Orders_1_1Fills.html">QuantConnect.Orders.Fills</a></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{<span class="comment"></span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">    /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">    /// Provides a base class for all fill models</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">    /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html">   30</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html" title="Provides a base class for all fill models">FillModel</a> : <a class="code" href="interfaceQuantConnect_1_1Orders_1_1Fills_1_1IFillModel.html" title="Represents a model that simulates order fill events">IFillModel</a></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    {<span class="comment"></span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">        /// The parameters instance to be used by the different XxxxFill() implementations</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc">   35</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html" title="Defines the parameters for the IFillModel method">FillModelParameters</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">        /// This is required due to a limitation in PythonNet to resolved overriden methods.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">        /// When Python calls a C# method that calls a method that&#39;s overriden in python it won&#39;t</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">        /// run the python implementation unless the call is performed through python too.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a007753302b91474b140073044ec318aa">   42</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <a class="code" href="classQuantConnect_1_1Python_1_1FillModelPythonWrapper.html" title="Wraps a PyObject object that represents a model that simulates order fill events">FillModelPythonWrapper</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a007753302b91474b140073044ec318aa" title="This is required due to a limitation in PythonNet to resolved overriden methods. When Python calls a ...">PythonWrapper</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">        /// Used to set the &lt;see cref=&quot;FillModelPythonWrapper&quot;/&gt; instance if any</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a9e54387daacc230f2584e2966ec6ac8f">   47</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a9e54387daacc230f2584e2966ec6ac8f" title="Used to set the FillModelPythonWrapper instance if any">SetPythonWrapper</a>(<a class="code" href="classQuantConnect_1_1Python_1_1FillModelPythonWrapper.html" title="Wraps a PyObject object that represents a model that simulates order fill events">FillModelPythonWrapper</a> pythonWrapper)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> = pythonWrapper;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">        /// Return an order event with the fill details</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">        /// &lt;param name=&quot;parameters&quot;&gt;A &lt;see cref=&quot;FillModelParameters&quot;/&gt; object containing the security and order&lt;/param&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab2919d2ee3ef2bd42013884458871c85">   57</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Fill.html" title="Defines a possible result for IFillModel.Fill for a single order">Fill</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab2919d2ee3ef2bd42013884458871c85" title="Return an order event with the fill details">Fill</a>(<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html" title="Defines the parameters for the IFillModel method">FillModelParameters</a> parameters)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            <span class="comment">// Important: setting the parameters is required because it is</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <span class="comment">// consumed by the different XxxxFill() implementations</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a> = parameters;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            var orderEvents = <span class="keyword">new</span> List&lt;OrderEvent&gt;(1);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            <span class="keywordflow">switch</span> (parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a24356f147d71c51b93ac023f7a443878" title="Order Type">Type</a>)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.Market:</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.MarketFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOrder.html" title="Market order type definition">MarketOrder</a>)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ae5a94a4470b2567a06a895cd7d34df7b" title="Default market fill model for the base security class. Fills at the last traded price.">MarketFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOrder.html" title="Market order type definition">MarketOrder</a>));</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.Limit:</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.LimitFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1LimitOrder.html" title="Limit order type definition">LimitOrder</a>)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a65ca61ef8b462f58155599370318afc6" title="Default limit order fill model in the base security class.">LimitFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1LimitOrder.html" title="Limit order type definition">LimitOrder</a>));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.LimitIfTouched:</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.LimitIfTouchedFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html" title="In effect, a LimitIfTouchedOrder behaves opposite to the StopLimitOrder; after a trigger price is tou...">LimitIfTouchedOrder</a>)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a03f85d58af5d7d59f31711cb0e610469" title="Default limit if touched fill model implementation in base class security. (Limit If Touched Order Ty...">LimitIfTouchedFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html" title="In effect, a LimitIfTouchedOrder behaves opposite to the StopLimitOrder; after a trigger price is tou...">LimitIfTouchedOrder</a>));</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.StopMarket:</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.StopMarketFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html" title="Stop Market Order Type Definition">StopMarketOrder</a>)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ae06620d63879e22f772f5ce6516b2e23" title="Default stop fill model implementation in base class security. (Stop Market Order Type)">StopMarketFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html" title="Stop Market Order Type Definition">StopMarketOrder</a>));</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.TrailingStop:</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.TrailingStopFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1TrailingStopOrder.html" title="Trailing Stop Order Type Definition">TrailingStopOrder</a>)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a39c944209b8e9f10f7385221c70cab9c" title="Default trailing stop fill model implementation in base class security. (Trailing Stop Order Type)">TrailingStopFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1TrailingStopOrder.html" title="Trailing Stop Order Type Definition">TrailingStopOrder</a>));</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.StopLimit:</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.StopLimitFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html" title="Stop Market Order Type Definition">StopLimitOrder</a>)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a1ab527801299a1e2667ff1a983685217" title="Default stop limit fill model implementation in base class security. (Stop Limit Order Type)">StopLimitFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html" title="Stop Market Order Type Definition">StopLimitOrder</a>));</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.MarketOnOpen:</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.MarketOnOpenFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOnOpenOrder.html" title="Market on Open order type, submits a market order when the exchange opens">MarketOnOpenOrder</a>)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ad6b2c831ede0fe9358c0310ba05e1290" title="Market on Open Fill Model. Return an order event with the fill details">MarketOnOpenFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOnOpenOrder.html" title="Market on Open order type, submits a market order when the exchange opens">MarketOnOpenOrder</a>));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.MarketOnClose:</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    orderEvents.Add(<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.MarketOnCloseFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOnCloseOrder.html" title="Market on close order type - submits a market order on exchange close">MarketOnCloseOrder</a>)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#aaebba1509472c6d2a29d1a04727f397f" title="Market on Close Fill Model. Return an order event with the fill details">MarketOnCloseFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abc5506027e2ed0d25d887b03c3c3786b" title="Gets the Security">Security</a>, parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a> as <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOnCloseOrder.html" title="Market on close order type - submits a market order on exchange close">MarketOnCloseOrder</a>));</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.ComboMarket:</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    orderEvents = <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.ComboMarketFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a>, parameters)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a0e3d13892a0e5a665ef35a4a786ca054" title="Default combo market fill model for the base security class. Fills at the last traded price for each ...">ComboMarketFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a>, parameters);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.ComboLimit:</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    orderEvents = <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.ComboLimitFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a>, parameters)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#af89571c5fca108830b3c0631b864c07d" title="Default combo limit fill model for the base security class. Fills at the sum of prices for the assets...">ComboLimitFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a>, parameters);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.ComboLegLimit:</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    orderEvents = <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                        ? <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.ComboLegLimitFill(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a>, parameters)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        : <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a9eaba19b4e54181c8141c3b790a8540c" title="Default combo limit fill model for the base security class. Fills at the limit price for each leg">ComboLegLimitFill</a>(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#abe20769857739e678ba8d2d2aa0d2079" title="Gets the Order">Order</a>, parameters);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab2919d2ee3ef2bd42013884458871c85" title="Return an order event with the fill details">Fill</a>(orderEvents);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">        /// Default combo market fill model for the base security class. Fills at the last traded price for each leg.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order to fill&lt;/param&gt;</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">        /// &lt;param name=&quot;parameters&quot;&gt;Fill parameters for the order&lt;/param&gt;</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled for each leg. If any of the fills fails, none of the orders will be filled and the returned list will be empty&lt;/returns&gt;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a0e3d13892a0e5a665ef35a4a786ca054">  134</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> List&lt;OrderEvent&gt; <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a0e3d13892a0e5a665ef35a4a786ca054" title="Default combo market fill model for the base security class. Fills at the last traded price for each ...">ComboMarketFill</a>(<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> order, <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html" title="Defines the parameters for the IFillModel method">FillModelParameters</a> parameters)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            var fills = <span class="keyword">new</span> List&lt;OrderEvent&gt;(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#a18897411966080292784c69af34ecd10" title="Gets the collection of securities by order">SecuritiesForOrders</a>.Count);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">foreach</span> (var kvp <span class="keywordflow">in</span> parameters.SecuritiesForOrders.OrderBy(x =&gt; x.Key.Id))</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                var targetOrder = kvp.Key;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                var security = kvp.Value;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                var fill = InternalMarketFill(security, targetOrder, targetOrder.Quantity);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="keywordflow">if</span> (fill.Status != <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">new</span> List&lt;OrderEvent&gt;();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                fills.Add(fill);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">return</span> fills;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">        /// Default combo limit fill model for the base security class. Fills at the sum of prices for the assets of every leg.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order to fill&lt;/param&gt;</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">        /// &lt;param name=&quot;parameters&quot;&gt;Fill parameters for the order&lt;/param&gt;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled for each leg. If any of the fills fails, none of the orders will be filled and the returned list will be empty&lt;/returns&gt;</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#af89571c5fca108830b3c0631b864c07d">  159</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> List&lt;OrderEvent&gt; <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#af89571c5fca108830b3c0631b864c07d" title="Default combo limit fill model for the base security class. Fills at the sum of prices for the assets...">ComboLimitFill</a>(<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> order, <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html" title="Defines the parameters for the IFillModel method">FillModelParameters</a> parameters)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="comment">// aggregate the prices from all the securities</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            var fillParameters = <span class="keyword">new</span> List&lt;ComboLimitOrderLegParameters&gt;(parameters.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#a18897411966080292784c69af34ecd10" title="Gets the collection of securities by order">SecuritiesForOrders</a>.Count);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">foreach</span> (var kvp <span class="keywordflow">in</span> parameters.SecuritiesForOrders.OrderBy(x =&gt; x.Key.Id))</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                var targetOrder = kvp.Key;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                var security = kvp.Value;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                var prices = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(security, targetOrder.Direction);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                <span class="keywordflow">if</span> (prices.EndTime.ConvertToUtc(security.Exchange.TimeZone) &lt; targetOrder.Time)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    <span class="comment">// do not fill on stale data</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">new</span> List&lt;OrderEvent&gt;();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                fillParameters.Add(<span class="keyword">new</span> ComboLimitOrderLegParameters</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                    <a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> = security,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                    <a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> = targetOrder,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a> = prices</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                });</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            var currentPrice = fillParameters.Aggregate(0m, (accumulatedPrice, p) =&gt; accumulatedPrice + p.Price);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            var limitPrice = order.GroupOrderManager.LimitPrice;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            var fills = <span class="keyword">new</span> List&lt;OrderEvent&gt;(fillParameters.Count);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="keywordflow">switch</span> (order.GroupOrderManager.Direction)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                    <span class="comment">//Buy limit seeks lowest price</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                    <span class="keywordflow">if</span> (currentPrice &lt; limitPrice)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                    {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        <span class="keywordflow">for</span> (var i = 0; i &lt; fillParameters.Count; i++)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                            var targetParameters = fillParameters[i];</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                            var utcTime = targetParameters.Security.LocalTime.ConvertToUtc(targetParameters.Security.Exchange.TimeZone);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(targetParameters.Order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                            <span class="comment">//Set order fill:</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                            fill.FillPrice = targetParameters.Prices.Low;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                            <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                            fill.FillQuantity = targetParameters.Order.Quantity;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                            fills.Add(fill);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    <span class="comment">//Sell limit seeks highest price possible</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="keywordflow">if</span> (currentPrice &gt; limitPrice)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                    {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                        <span class="keywordflow">for</span> (var i = 0; i &lt; fillParameters.Count; i++)</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                            var targetParameters = fillParameters[i];</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                            var utcTime = targetParameters.Security.LocalTime.ConvertToUtc(targetParameters.Security.Exchange.TimeZone);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(targetParameters.Order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                            <span class="comment">//Set order fill:</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                            fill.FillPrice = targetParameters.Prices.High;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                            <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                            fill.FillQuantity = targetParameters.Order.Quantity;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                            fills.Add(fill);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                        }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">return</span> fills;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">        /// Default combo limit fill model for the base security class. Fills at the limit price for each leg</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order to fill&lt;/param&gt;</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">        /// &lt;param name=&quot;parameters&quot;&gt;Fill parameters for the order&lt;/param&gt;</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled for each leg. If any of the fills fails, none of the orders will be filled and the returned list will be empty&lt;/returns&gt;</span></div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a9eaba19b4e54181c8141c3b790a8540c">  242</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> List&lt;OrderEvent&gt; <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a9eaba19b4e54181c8141c3b790a8540c" title="Default combo limit fill model for the base security class. Fills at the limit price for each leg">ComboLegLimitFill</a>(<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> order, <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html" title="Defines the parameters for the IFillModel method">FillModelParameters</a> parameters)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            var fills = <span class="keyword">new</span> List&lt;OrderEvent&gt;(order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a022f2ab2837311121e61e042fbef2aa3" title="Manager for the orders in the group if this is a combo order">GroupOrderManager</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1GroupOrderManager.html#ae6a345e98aea0446f0daa07503261fb4" title="The order Ids in this group">OrderIds</a>.Count);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <span class="keywordflow">foreach</span> (var kvp <span class="keywordflow">in</span> parameters.SecuritiesForOrders.OrderBy(x =&gt; x.Key.Id))</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                var targetOrder = kvp.Key;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                var security = kvp.Value;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                var fill = InternalLimitFill(security, targetOrder, (targetOrder as <a class="code" href="classQuantConnect_1_1Orders_1_1ComboLegLimitOrder.html" title="Combo leg limit order type">ComboLegLimitOrder</a>).<a class="code" href="namespaceQuantConnect_1_1Orders.html#a5a66429dc18da017ea73920f3650c375a9dfb4490ba04a98792ba43e79f9219dd" title="The limit price for a LimitOrder, StopLimitOrder or LimitIfTouchedOrder (0)">LimitPrice</a>,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    targetOrder.Quantity);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="keywordflow">if</span> (fill.Status != <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">new</span> List&lt;OrderEvent&gt;();</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                fills.Add(fill);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">return</span> fills;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">        /// Default market fill model for the base security class. Fills at the last traded price.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security asset we&#39;re filling&lt;/param&gt;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order packet to model&lt;/param&gt;</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ae5a94a4470b2567a06a895cd7d34df7b">  271</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ae5a94a4470b2567a06a895cd7d34df7b" title="Default market fill model for the base security class. Fills at the last traded price.">MarketFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOrder.html" title="Market order type definition">MarketOrder</a> order)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">return</span> InternalMarketFill(asset, order, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">        /// Default market fill model for the base security class. Fills at the last traded price.</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> InternalMarketFill(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> order, decimal quantity)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="comment">//Default order event to return.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="comment">// make sure the exchange is open/normal market hours before filling</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset, <span class="keyword">false</span>)) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            var orderDirection = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            var prices = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, orderDirection);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            var pricesEndTimeUtc = prices.EndTime.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="comment">// if the order is filled on stale (fill-forward) data, set a warning message on the order event</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <span class="keywordflow">if</span> (pricesEndTimeUtc.Add(<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#a3e23486b6a898c07e72e6e1c4664fbb2" title="Gets the minimum time span elapsed to consider a market fill price as stale (defaults to one hour)">StalePriceTimeSpan</a>) &lt; order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                fill.Message = <a class="code" href="classQuantConnect_1_1Messages.html" title="Provides user-facing message construction methods and static messages for the Algorithm....">Messages</a>.<a class="code" href="classQuantConnect_1_1Messages_1_1FillModel.html" title="Provides user-facing messages for the Orders.Fills.FillModel class and its consumers or related class...">FillModel</a>.FilledAtStalePrice(asset, prices);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="comment">//Order [fill]price for a market order model is the current security price</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            fill.FillPrice = prices.Current;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="comment">//Calculate the model slippage: e.g. 0.01c</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            var slip = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a5cf450eb0af636dee8faf2a6e6844a8a" title="Slippage model use to compute slippage of market orders">SlippageModel</a>.GetSlippageApproximation(asset, order);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="comment">//Apply slippage</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordflow">switch</span> (orderDirection)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    fill.FillPrice += slip;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    fill.FillPrice -= slip;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            fill.FillQuantity = quantity;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">        /// Default stop fill model implementation in base class security. (Stop Market Order Type)</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security asset we&#39;re filling&lt;/param&gt;</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order packet to model&lt;/param&gt;</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">        /// &lt;seealso cref=&quot;MarketFill(Security, MarketOrder)&quot;/&gt;</span></div>
<div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ae06620d63879e22f772f5ce6516b2e23">  332</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ae06620d63879e22f772f5ce6516b2e23" title="Default stop fill model implementation in base class security. (Stop Market Order Type)">StopMarketFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html" title="Stop Market Order Type Definition">StopMarketOrder</a> order)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="comment">//Default order event to return.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="comment">//If its cancelled don&#39;t need anymore checks:</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="comment">// make sure the exchange is open/normal market hours before filling</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset, <span class="keyword">false</span>)) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="comment">//Get the range of prices in the last bar:</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            var prices = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            var pricesEndTime = prices.EndTime.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="comment">// do not fill on stale data</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keywordflow">if</span> (pricesEndTime &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="comment">//Calculate the model slippage: e.g. 0.01c</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            var slip = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a5cf450eb0af636dee8faf2a6e6844a8a" title="Slippage model use to compute slippage of market orders">SlippageModel</a>.GetSlippageApproximation(asset, order);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="comment">//Check if the Stop Order was filled: opposite to a limit order</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">switch</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                    <span class="comment">//-&gt; 1.1 Sell Stop: If Price below setpoint, Sell:</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    <span class="keywordflow">if</span> (prices.Low &lt; order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                        <span class="comment">// Assuming worse case scenario fill - fill at lowest of the stop &amp; asset price.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        fill.FillPrice = Math.Min(order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>, prices.Current - slip);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                        <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                    <span class="comment">//-&gt; 1.2 Buy Stop: If Price Above Setpoint, Buy:</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    <span class="keywordflow">if</span> (prices.High &gt; order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                        fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                        <span class="comment">// Assuming worse case scenario fill - fill at highest of the stop &amp; asset price.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                        fill.FillPrice = Math.Max(order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>, prices.Current + slip);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                        <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                        fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">        /// Default trailing stop fill model implementation in base class security. (Trailing Stop Order Type)</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security asset we&#39;re filling&lt;/param&gt;</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order packet to model&lt;/param&gt;</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a39c944209b8e9f10f7385221c70cab9c">  391</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a39c944209b8e9f10f7385221c70cab9c" title="Default trailing stop fill model implementation in base class security. (Trailing Stop Order Type)">TrailingStopFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1TrailingStopOrder.html" title="Trailing Stop Order Type Definition">TrailingStopOrder</a> order)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="comment">// Default order event to return.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="comment">// If its canceled don&#39;t need anymore checks:</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="comment">// Make sure the exchange is open/normal market hours before filling</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset, <span class="keyword">false</span>)) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="comment">// Get the range of prices in the last bar:</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            var prices = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            var pricesEndTime = prices.EndTime.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="comment">// Do not fill on stale data</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">if</span> (pricesEndTime &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="comment">// Calculate the model slippage: e.g. 0.01c</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            var slip = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a5cf450eb0af636dee8faf2a6e6844a8a" title="Slippage model use to compute slippage of market orders">SlippageModel</a>.GetSlippageApproximation(asset, order);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">switch</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    <span class="comment">// Fill sell if market price drops below stop price</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                    <span class="keywordflow">if</span> (prices.Low &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                    {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                        <span class="comment">// Assuming worse case scenario fill - fill at lowest of the stop &amp; asset price.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                        fill.FillPrice = Math.Min(order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>, prices.Current - slip);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                        fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                    <span class="comment">// Fill buy if market price rises above stop price</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    <span class="keywordflow">if</span> (prices.High &gt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        <span class="comment">// Assuming worse case scenario fill - fill at highest of the stop &amp; asset price.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                        fill.FillPrice = Math.Max(order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>, prices.Current + slip);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="comment">// Update the stop price:</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="comment">// NOTE: Doing this after attempting to fill the order in the following cases:</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="comment">//  - Sell: if low &lt; stop price, order is filled. If we were to update the stop price before and it is moved towards the high price</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="comment">//          placing the stop price above the low price, it will not trigger a fill.</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="comment">//  - Buy: if high &gt; stop price, order is filled. If we were to update the stop price before and it is moved towards the low price</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="comment">//         placing the stop price below the high price, it will not trigger a fill.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">if</span> (fill.Status != <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled &amp;&amp;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <a class="code" href="classQuantConnect_1_1Orders_1_1TrailingStopOrder.html" title="Trailing Stop Order Type Definition">TrailingStopOrder</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1TrailingStopOrder.html#aca5a580ab01b88a70cc0be46d9f6e953" title="Tries to update the stop price for a trailing stop order given the current market price">TryUpdateStopPrice</a>(order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell ? prices.High : prices.Low, order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a>,</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    order.<a class="code" href="classQuantConnect_1_1Orders_1_1TrailingStopOrder.html#ab3c6196eda96caf4e8289046172480f5" title="Trailing amount for this trailing stop order">TrailingAmount</a>, order.<a class="code" href="classQuantConnect_1_1Orders_1_1TrailingStopOrder.html#ad013584fdd25badca356cd2b74cd1161" title="Determines whether the TrailingAmount is a percentage or an absolute currency value">TrailingAsPercentage</a>, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>, out var updatedStopPrice))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopMarketOrder.html#aa6d50b539c5f69a8da37dd53e665a67a" title="Stop price for this stop market order.">StopPrice</a> = updatedStopPrice;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#aae5a3dda44862b300dd19788659a0d4b" title="Callback to notify when an order is updated by the fill model">OnOrderUpdated</a>(order);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">        /// Default stop limit fill model implementation in base class security. (Stop Limit Order Type)</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security asset we&#39;re filling&lt;/param&gt;</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order packet to model&lt;/param&gt;</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">        /// &lt;seealso cref=&quot;StopMarketFill(Security, StopMarketOrder)&quot;/&gt;</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">        /// &lt;remarks&gt;</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">        ///     There is no good way to model limit orders with OHLC because we never know whether the market has</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">        ///     gapped past our fill price. We have to make the assumption of a fluid, high volume market.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">        ///</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">        ///     Stop limit orders we also can&#39;t be sure of the order of the H - L values for the limit fill. The assumption</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">        ///     was made the limit fill will be done with closing price of the bar after the stop has been triggered..</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">        /// &lt;/remarks&gt;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a1ab527801299a1e2667ff1a983685217">  471</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a1ab527801299a1e2667ff1a983685217" title="Default stop limit fill model implementation in base class security. (Stop Limit Order Type)">StopLimitFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html" title="Stop Market Order Type Definition">StopLimitOrder</a> order)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="comment">//Default order event to return.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="comment">//If its cancelled don&#39;t need anymore checks:</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="comment">// make sure the exchange is open before filling -- allow pre/post market fills to occur</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset))</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="comment">//Get the range of prices in the last bar:</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            var prices = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            var pricesEndTime = prices.EndTime.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="comment">// do not fill on stale data</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keywordflow">if</span> (pricesEndTime &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="comment">//Check if the Stop Order was filled: opposite to a limit order</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <span class="keywordflow">switch</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    <span class="comment">//-&gt; 1.2 Buy Stop: If Price Above Setpoint, Buy:</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                    <span class="keywordflow">if</span> (prices.High &gt; order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a4ccdf4bda83345cffce0789725dcee21" title="Stop price for this stop market order.">StopPrice</a> || order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a57d52437759de4765fd336e9ef4dafad" title="Signal showing the &quot;StopLimitOrder&quot; has been converted into a Limit Order">StopTriggered</a>)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                    {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                        <span class="keywordflow">if</span> (!order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a57d52437759de4765fd336e9ef4dafad" title="Signal showing the &quot;StopLimitOrder&quot; has been converted into a Limit Order">StopTriggered</a>)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                        {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                            order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a57d52437759de4765fd336e9ef4dafad" title="Signal showing the &quot;StopLimitOrder&quot; has been converted into a Limit Order">StopTriggered</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                            <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#aae5a3dda44862b300dd19788659a0d4b" title="Callback to notify when an order is updated by the fill model">OnOrderUpdated</a>(order);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                        <span class="comment">// Fill the limit order, using closing price of bar:</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                        <span class="comment">// Note &gt; Can&#39;t use minimum price, because no way to be sure minimum wasn&#39;t before the stop triggered.</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                        <span class="keywordflow">if</span> (prices.Current &lt; order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a755835523b05f1c7f587e86229a2885a" title="Limit price for the stop limit order">LimitPrice</a>)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                        {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                            fill.FillPrice = Math.Min(prices.High, order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a755835523b05f1c7f587e86229a2885a" title="Limit price for the stop limit order">LimitPrice</a>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                            <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                            fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                        }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    <span class="comment">//-&gt; 1.1 Sell Stop: If Price below setpoint, Sell:</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                    <span class="keywordflow">if</span> (prices.Low &lt; order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a4ccdf4bda83345cffce0789725dcee21" title="Stop price for this stop market order.">StopPrice</a> || order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a57d52437759de4765fd336e9ef4dafad" title="Signal showing the &quot;StopLimitOrder&quot; has been converted into a Limit Order">StopTriggered</a>)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                    {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        <span class="keywordflow">if</span> (!order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a57d52437759de4765fd336e9ef4dafad" title="Signal showing the &quot;StopLimitOrder&quot; has been converted into a Limit Order">StopTriggered</a>)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                            order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a57d52437759de4765fd336e9ef4dafad" title="Signal showing the &quot;StopLimitOrder&quot; has been converted into a Limit Order">StopTriggered</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                            <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#aae5a3dda44862b300dd19788659a0d4b" title="Callback to notify when an order is updated by the fill model">OnOrderUpdated</a>(order);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                        }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                        <span class="comment">// Fill the limit order, using minimum price of the bar</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                        <span class="comment">// Note &gt; Can&#39;t use minimum price, because no way to be sure minimum wasn&#39;t before the stop triggered.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                        <span class="keywordflow">if</span> (prices.Current &gt; order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a755835523b05f1c7f587e86229a2885a" title="Limit price for the stop limit order">LimitPrice</a>)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                        {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                            fill.FillPrice = Math.Max(prices.Low, order.<a class="code" href="classQuantConnect_1_1Orders_1_1StopLimitOrder.html#a755835523b05f1c7f587e86229a2885a" title="Limit price for the stop limit order">LimitPrice</a>);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                            <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                            fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                    }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">        /// Default limit if touched fill model implementation in base class security. (Limit If Touched Order Type)</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">        /// &lt;remarks&gt;</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">        ///     There is no good way to model limit orders with OHLC because we never know whether the market has</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">        ///     gapped past our fill price. We have to make the assumption of a fluid, high volume market.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">        ///</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">        ///     With Limit if Touched orders, whether or not a trigger is surpassed is determined by the high (low)</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">        ///     of the previous tradebar when making a sell (buy) request. Following the behaviour of</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">        ///     &lt;see cref=&quot;StopLimitFill&quot;/&gt;, current quote information is used when determining fill parameters</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">        ///     (e.g., price, quantity) as the tradebar containing the incoming data is not yet consolidated.</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">        ///     This conservative approach, however, can lead to trades not occuring as would be expected when</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">        ///     compared to future consolidated data.</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">        /// &lt;/remarks&gt;</span></div>
<div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a03f85d58af5d7d59f31711cb0e610469">  561</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a03f85d58af5d7d59f31711cb0e610469" title="Default limit if touched fill model implementation in base class security. (Limit If Touched Order Ty...">LimitIfTouchedFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html" title="In effect, a LimitIfTouchedOrder behaves opposite to the StopLimitOrder; after a trigger price is tou...">LimitIfTouchedOrder</a> order)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="comment">//Default order event to return.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="comment">//If its cancelled don&#39;t need anymore checks:</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="comment">// Fill only if open or extended</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset))</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="comment">// Get the range of prices in the last bar:</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            var tradeHigh = 0m;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            var tradeLow = 0m;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            var pricesEndTime = DateTime.MinValue;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            var subscribedTypes = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a71f8f74b6d7f6180d711911667671c49" title="Get data types the Security is subscribed to">GetSubscribedTypes</a>(asset);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordflow">if</span> (subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html" title="Tick class is the base representation for tick data. It is grouped into a Ticks object which implemen...">Tick</a>)))</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                var trade = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                <span class="keywordflow">if</span> (trade != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    tradeHigh = trade.Current;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    tradeLow = trade.Current;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                    pricesEndTime = trade.EndTime.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>)))</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                var tradeBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>&gt;();</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                <span class="keywordflow">if</span> (tradeBar != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                    tradeHigh = tradeBar.<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html#a16bac61cfbbd3a02821b72676db0ca6c" title="High price of the TradeBar during the time period.">High</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                    tradeLow = tradeBar.Low;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                    pricesEndTime = tradeBar.EndTime.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="comment">// do not fill on stale data</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">if</span> (pricesEndTime &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="keywordflow">switch</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    <span class="keywordflow">if</span> (tradeHigh &gt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#a2d4237ccebe9abbb8057a8db729d0304" title="The price which, when touched, will trigger the setting of a limit order at LimitPrice.">TriggerPrice</a> || order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#aa8a3ae5819cbe958adc83efef1e76136" title="Whether or not the TriggerPrice has been touched.">TriggerTouched</a>)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                    {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                        order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#aa8a3ae5819cbe958adc83efef1e76136" title="Whether or not the TriggerPrice has been touched.">TriggerTouched</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                        <span class="comment">//-&gt; 1.1 Limit surpassed: Sell.</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                        <span class="keywordflow">if</span> (GetAskPrice(asset, out pricesEndTime) &gt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#ae28041f09e0918648f6d1e872fd9230b" title="The price at which to set the limit order following TriggerPrice being touched.">LimitPrice</a>)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                            fill.FillPrice = order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#ae28041f09e0918648f6d1e872fd9230b" title="The price at which to set the limit order following TriggerPrice being touched.">LimitPrice</a>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                            <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                            fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                        }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                    }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                    <span class="keywordflow">if</span> (tradeLow &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#a2d4237ccebe9abbb8057a8db729d0304" title="The price which, when touched, will trigger the setting of a limit order at LimitPrice.">TriggerPrice</a> || order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#aa8a3ae5819cbe958adc83efef1e76136" title="Whether or not the TriggerPrice has been touched.">TriggerTouched</a>)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                    {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                        order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#aa8a3ae5819cbe958adc83efef1e76136" title="Whether or not the TriggerPrice has been touched.">TriggerTouched</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                        <span class="comment">//-&gt; 1.2 Limit surpassed: Buy.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                        <span class="keywordflow">if</span> (GetBidPrice(asset, out pricesEndTime) &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#ae28041f09e0918648f6d1e872fd9230b" title="The price at which to set the limit order following TriggerPrice being touched.">LimitPrice</a>)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                        {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                            fill.FillPrice = order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitIfTouchedOrder.html#ae28041f09e0918648f6d1e872fd9230b" title="The price at which to set the limit order following TriggerPrice being touched.">LimitPrice</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                            <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                            fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                        }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            }</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">        /// Default limit order fill model in the base security class.</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security asset we&#39;re filling&lt;/param&gt;</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order packet to model&lt;/param&gt;</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">        /// &lt;seealso cref=&quot;StopMarketFill(Security, StopMarketOrder)&quot;/&gt;</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">        /// &lt;seealso cref=&quot;MarketFill(Security, MarketOrder)&quot;/&gt;</span></div>
<div class="line"><a name="l00655"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a65ca61ef8b462f58155599370318afc6">  655</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a65ca61ef8b462f58155599370318afc6" title="Default limit order fill model in the base security class.">LimitFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1LimitOrder.html" title="Limit order type definition">LimitOrder</a> order)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">return</span> InternalLimitFill(asset, order, order.<a class="code" href="classQuantConnect_1_1Orders_1_1LimitOrder.html#a0fa376b46a438a01f5fb851a95bb828a" title="Limit price for this order.">LimitPrice</a>, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">        /// Default limit order fill model in the base security class.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> InternalLimitFill(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> order, decimal limitPrice, decimal quantity)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="comment">//Initialise;</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="comment">//If its cancelled don&#39;t need anymore checks:</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <span class="comment">// make sure the exchange is open before filling -- allow pre/post market fills to occur</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset))</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="comment">//Get the range of prices in the last bar:</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            var orderDirection = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            var prices = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, orderDirection);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            var pricesEndTime = prices.EndTime.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="comment">// do not fill on stale data</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="keywordflow">if</span> (pricesEndTime &lt;= order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="comment">//-&gt; Valid Live/Model Order:</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="keywordflow">switch</span> (orderDirection)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                    <span class="comment">//Buy limit seeks lowest price</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                    <span class="keywordflow">if</span> (prices.Low &lt; limitPrice)</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                    {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                        <span class="comment">//Set order fill:</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                        fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                        <span class="comment">// fill at the worse price this bar or the limit price, this allows far out of the money limits</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                        <span class="comment">// to be executed properly</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                        fill.FillPrice = Math.Min(prices.High, limitPrice);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                        <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                        fill.FillQuantity = quantity;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                    }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                    <span class="comment">//Sell limit seeks highest price possible</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                    <span class="keywordflow">if</span> (prices.High &gt; limitPrice)</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                    {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                        fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                        <span class="comment">// fill at the worse price this bar or the limit price, this allows far out of the money limits</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                        <span class="comment">// to be executed properly</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                        fill.FillPrice = Math.Max(prices.Low, limitPrice);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                        fill.FillQuantity = quantity;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                    }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">        /// Market on Open Fill Model. Return an order event with the fill details</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Asset we&#39;re trading with this order&lt;/param&gt;</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order to be filled&lt;/param&gt;</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00724"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ad6b2c831ede0fe9358c0310ba05e1290">  724</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ad6b2c831ede0fe9358c0310ba05e1290" title="Market on Open Fill Model. Return an order event with the fill details">MarketOnOpenFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOnOpenOrder.html" title="Market on Open order type, submits a market order when the exchange opens">MarketOnOpenOrder</a> order)</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <span class="keywordflow">if</span> (asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#ad5d411f6c563907f51580d0ab17a1643" title="Gets the SecurityExchangeHours for this exchange">Hours</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html#a656a4e98bbf3489755f1bad104ad987c" title="Checks whether the market is always open or not">IsMarketAlwaysOpen</a>)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<a class="code" href="classQuantConnect_1_1Messages.html" title="Provides user-facing message construction methods and static messages for the Algorithm....">Messages</a>.<a class="code" href="classQuantConnect_1_1Messages_1_1FillModel.html" title="Provides user-facing messages for the Orders.Fills.FillModel class and its consumers or related class...">FillModel</a>.MarketNeverCloses(asset, <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.MarketOnOpen));</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            }</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="comment">// MOO should never fill on the same bar or on stale data</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="comment">// Imagine the case where we have a thinly traded equity, ASUR, and another liquid</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <span class="comment">// equity, say SPY, SPY gets data every minute but ASUR, if not on fill forward, maybe</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="comment">// have large gaps, in which case the currentBar.EndTime will be in the past</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            <span class="comment">// ASUR  | | |      [order]        | | | | | | |</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            <span class="comment">//  SPY  | | | | | | | | | | | | | | | | | | | |</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            var currentBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#ab93a58a84a4aa1b19d0972faf6c056c4" title="Get the last price update set to the security if any else null">GetLastData</a>();</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            var localOrderTime = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>.ConvertFromUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="keywordflow">if</span> (currentBar == <span class="keyword">null</span> || localOrderTime &gt;= currentBar.EndTime) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="comment">// if the MOO was submitted during market the previous day, wait for a day to turn over</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">if</span> (asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#a0cb909c2d8b9da2709749846b313e3bb" title="Check if this DateTime is open.">DateTimeIsOpen</a>(localOrderTime) &amp;&amp; localOrderTime.Date == asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.Date)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="comment">// wait until market open</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="comment">// make sure the exchange is open/normal market hours before filling</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset, <span class="keyword">false</span>)) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            fill.FillPrice = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>).<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html#a4fc2a54f430f7b67742bd49c8efb9559" title="Open price">Open</a>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="comment">//Calculate the model slippage: e.g. 0.01c</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            var slip = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a5cf450eb0af636dee8faf2a6e6844a8a" title="Slippage model use to compute slippage of market orders">SlippageModel</a>.GetSlippageApproximation(asset, order);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="comment">//Apply slippage</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">switch</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    fill.FillPrice += slip;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                    fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                    fill.FillPrice -= slip;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                    <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                    fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">        /// Market on Close Fill Model. Return an order event with the fill details</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Asset we&#39;re trading with this order&lt;/param&gt;</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">        /// &lt;param name=&quot;order&quot;&gt;Order to be filled&lt;/param&gt;</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">        /// &lt;returns&gt;Order fill information detailing the average price and quantity filled.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00785"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#aaebba1509472c6d2a29d1a04727f397f">  785</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#aaebba1509472c6d2a29d1a04727f397f" title="Market on Close Fill Model. Return an order event with the fill details">MarketOnCloseFill</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="classQuantConnect_1_1Orders_1_1MarketOnCloseOrder.html" title="Market on close order type - submits a market order on exchange close">MarketOnCloseOrder</a> order)</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <span class="keywordflow">if</span> (asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#ad5d411f6c563907f51580d0ab17a1643" title="Gets the SecurityExchangeHours for this exchange">Hours</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html#a656a4e98bbf3489755f1bad104ad987c" title="Checks whether the market is always open or not">IsMarketAlwaysOpen</a>)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<a class="code" href="classQuantConnect_1_1Messages.html" title="Provides user-facing message construction methods and static messages for the Algorithm....">Messages</a>.<a class="code" href="classQuantConnect_1_1Messages_1_1FillModel.html" title="Provides user-facing messages for the Orders.Fills.FillModel class and its consumers or related class...">FillModel</a>.MarketNeverCloses(asset, <a class="code" href="namespaceQuantConnect_1_1Orders.html#a5d75e786a70a68a4999da57a060fa8db" title="Type of the order: market, limit or stop">OrderType</a>.MarketOnClose));</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            var utcTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.ConvertToUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            var fill = <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1OrderEvent.html" title="Order Event - Messaging class signifying a change in an order state and record the change in the user...">OrderEvent</a>(order, utcTime, <a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html" title="Defines the result for IFeeModel.GetOrderFee">OrderFee</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fees_1_1OrderFee.html#aaab8320620053d9a98dd4bf92753d54d" title="Gets an instance of OrderFee that represents zero.">Zero</a>);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <span class="keywordflow">if</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#acfcc3e4d398277a5c6bce4b672b6cbbc" title="Status of the Order">Status</a> == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Canceled) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            var localOrderTime = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#afa2841f11b0b54ad223be5b205c2d00d" title="Gets the utc time the order was created.">Time</a>.ConvertFromUtc(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#aec5dd706b28d773157062fec704bd9d0" title="Gets the time zone for this exchange">TimeZone</a>);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            var nextMarketClose = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#ad5d411f6c563907f51580d0ab17a1643" title="Gets the SecurityExchangeHours for this exchange">Hours</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html#ae4d431df8172a13151fbc6dcad979492" title="Gets the local date time corresponding to the next market close following the specified time">GetNextMarketClose</a>(localOrderTime, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="comment">// wait until market closes after the order time</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="keywordflow">if</span> (asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a> &lt; nextMarketClose)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="comment">// make sure the exchange is open/normal market hours before filling</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="keywordflow">if</span> (!IsExchangeOpen(asset, <span class="keyword">false</span>)) <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            fill.FillPrice = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(asset, order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>).<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html#af09019cd9b9ba93c634c5f68325a3679" title="Closing price">Close</a>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            fill.Status = <a class="code" href="namespaceQuantConnect_1_1Orders.html#a4487359515f6c3c178dd4f717ae20409" title="Fill status of the order class.">OrderStatus</a>.Filled;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="comment">//Calculate the model slippage: e.g. 0.01c</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            var slip = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a5cf450eb0af636dee8faf2a6e6844a8a" title="Slippage model use to compute slippage of market orders">SlippageModel</a>.GetSlippageApproximation(asset, order);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="comment">//Apply slippage</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordflow">switch</span> (order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a09db61a083f7006f8a521e2c1f632dd3" title="Order Direction Property based off Quantity.">Direction</a>)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            {</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy:</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                    fill.FillPrice += slip;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                    fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell:</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                    fill.FillPrice -= slip;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    <span class="comment">// assume the order completely filled</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                    fill.FillQuantity = order.<a class="code" href="classQuantConnect_1_1Orders_1_1Order.html#a79b576288b24574b5705b615cb3df6e2" title="Number of shares to execute.">Quantity</a>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">return</span> fill;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">        /// Get current ask price for subscribed data</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">        /// This method will try to get the most recent ask price data, so it will try to get tick quote first, then quote bar.</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">        /// If no quote, tick or bar, is available (e.g. hourly data), use trade data with preference to tick data.</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security which has subscribed data types&lt;/param&gt;</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">        /// &lt;param name=&quot;endTime&quot;&gt;Timestamp of the most recent data type&lt;/param&gt;</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> decimal GetAskPrice(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, out DateTime endTime)</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            var subscribedTypes = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a71f8f74b6d7f6180d711911667671c49" title="Get data types the Security is subscribed to">GetSubscribedTypes</a>(asset);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            List&lt;Tick&gt; ticks = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            var isTickSubscribed = subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html" title="Tick class is the base representation for tick data. It is grouped into a Ticks object which implemen...">Tick</a>));</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordflow">if</span> (isTickSubscribed)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                ticks = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.GetAll&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html" title="Tick class is the base representation for tick data. It is grouped into a Ticks object which implemen...">Tick</a>&gt;().ToList();</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160; </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                var quote = ticks.LastOrDefault(x =&gt; x.TickType == <a class="code" href="namespaceQuantConnect.html#a895ea6ee7ae9e742803aecfc2b51f6cb" title="Types of tick data">TickType</a>.Quote &amp;&amp; x.AskPrice &gt; 0);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                <span class="keywordflow">if</span> (quote != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                    endTime = quote.EndTime;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                    <span class="keywordflow">return</span> quote.AskPrice;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160; </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            <span class="keywordflow">if</span> (subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html" title="QuoteBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">QuoteBar</a>)))</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                var quoteBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html" title="QuoteBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">QuoteBar</a>&gt;();</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                <span class="keywordflow">if</span> (quoteBar != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                    endTime = quoteBar.<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html#a3aa7f8353a88691510d06afdaed0ae7f" title="The closing time of this bar, computed via the Time and Period">EndTime</a>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                    <span class="keywordflow">return</span> quoteBar.Ask?.Close ?? quoteBar.Close;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keywordflow">if</span> (isTickSubscribed)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                var trade = ticks.LastOrDefault(x =&gt; x.TickType == <a class="code" href="namespaceQuantConnect.html#a895ea6ee7ae9e742803aecfc2b51f6cb" title="Types of tick data">TickType</a>.Trade &amp;&amp; x.Price &gt; 0);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="keywordflow">if</span> (trade != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                    endTime = trade.EndTime;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                    <span class="keywordflow">return</span> trade.Price;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="keywordflow">if</span> (subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>)))</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                var tradeBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>&gt;();</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                <span class="keywordflow">if</span> (tradeBar != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                    endTime = tradeBar.<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html#a3cea02e39f14946618ee0c186bd2888c" title="The closing time of this bar, computed via the Time and Period">EndTime</a>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                    <span class="keywordflow">return</span> tradeBar.Close;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(Messages.FillModel.NoMarketDataToGetAskPriceForFilling(asset));</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">        /// Get current bid price for subscribed data</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">        /// This method will try to get the most recent bid price data, so it will try to get tick quote first, then quote bar.</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">        /// If no quote, tick or bar, is available (e.g. hourly data), use trade data with preference to tick data.</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security which has subscribed data types&lt;/param&gt;</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">        /// &lt;param name=&quot;endTime&quot;&gt;Timestamp of the most recent data type&lt;/param&gt;</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> decimal GetBidPrice(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, out DateTime endTime)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            var subscribedTypes = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a71f8f74b6d7f6180d711911667671c49" title="Get data types the Security is subscribed to">GetSubscribedTypes</a>(asset);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            List&lt;Tick&gt; ticks = <span class="keyword">null</span>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            var isTickSubscribed = subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html" title="Tick class is the base representation for tick data. It is grouped into a Ticks object which implemen...">Tick</a>));</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">if</span> (isTickSubscribed)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                ticks = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.GetAll&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html" title="Tick class is the base representation for tick data. It is grouped into a Ticks object which implemen...">Tick</a>&gt;().ToList();</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                var quote = ticks.LastOrDefault(x =&gt; x.TickType == <a class="code" href="namespaceQuantConnect.html#a895ea6ee7ae9e742803aecfc2b51f6cb" title="Types of tick data">TickType</a>.Quote &amp;&amp; x.BidPrice &gt; 0);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                <span class="keywordflow">if</span> (quote != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                    endTime = quote.EndTime;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                    <span class="keywordflow">return</span> quote.BidPrice;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">if</span> (subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html" title="QuoteBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">QuoteBar</a>)))</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                var quoteBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html" title="QuoteBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">QuoteBar</a>&gt;();</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                <span class="keywordflow">if</span> (quoteBar != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                    endTime = quoteBar.<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html#a3aa7f8353a88691510d06afdaed0ae7f" title="The closing time of this bar, computed via the Time and Period">EndTime</a>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                    <span class="keywordflow">return</span> quoteBar.Bid?.Close ?? quoteBar.Close;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="keywordflow">if</span> (isTickSubscribed)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                var trade = ticks.LastOrDefault(x =&gt; x.TickType == <a class="code" href="namespaceQuantConnect.html#a895ea6ee7ae9e742803aecfc2b51f6cb" title="Types of tick data">TickType</a>.Trade &amp;&amp; x.Price &gt; 0);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                <span class="keywordflow">if</span> (trade != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                    endTime = trade.EndTime;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                    <span class="keywordflow">return</span> trade.Price;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">if</span> (subscribedTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>)))</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                var tradeBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>&gt;();</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                <span class="keywordflow">if</span> (tradeBar != <span class="keyword">null</span>)</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                    endTime = tradeBar.<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html#a3cea02e39f14946618ee0c186bd2888c" title="The closing time of this bar, computed via the Time and Period">EndTime</a>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                    <span class="keywordflow">return</span> tradeBar.Close;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(Messages.FillModel.NoMarketDataToGetBidPriceForFilling(asset));</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">        /// Get data types the Security is subscribed to</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security which has subscribed data types&lt;/param&gt;</span></div>
<div class="line"><a name="l00953"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a71f8f74b6d7f6180d711911667671c49">  953</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> HashSet&lt;Type&gt; <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a71f8f74b6d7f6180d711911667671c49" title="Get data types the Security is subscribed to">GetSubscribedTypes</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset)</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            var subscribedTypes = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                .<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#aff6129dcf41708c253a667069cf11b79" title="Gets the SubscriptionDataConfig provider">ConfigProvider</a></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                <span class="comment">// even though data from internal configurations are not sent to the algorithm.OnData they still drive security cache and data</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                <span class="comment">// this is specially relevant for the continuous contract underlying mapped contracts which are internal configurations</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                .GetSubscriptionDataConfigs(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a3b72b42a193c52a586bd2b17c54fecf9" title="Symbol for the asset.">Symbol</a>, includeInternalConfigs: <span class="keyword">true</span>)</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                .ToHashSet(x =&gt; x.Type);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160; </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="keywordflow">if</span> (subscribedTypes.Count == 0)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<a class="code" href="classQuantConnect_1_1Messages.html" title="Provides user-facing message construction methods and static messages for the Algorithm....">Messages</a>.<a class="code" href="classQuantConnect_1_1Messages_1_1FillModel.html" title="Provides user-facing messages for the Orders.Fills.FillModel class and its consumers or related class...">FillModel</a>.NoDataSubscriptionFoundForFilling(asset));</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            <span class="keywordflow">return</span> subscribedTypes;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">        /// Helper method to determine if the exchange is open before filling. Will allow pre/post market fills to occur based on configuration</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security which has subscribed data types&lt;/param&gt;</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> <span class="keywordtype">bool</span> IsExchangeOpen(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            <span class="comment">// even though data from internal configurations are not sent to the algorithm.OnData they still drive security cache and data</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <span class="comment">// this is specially relevant for the continuous contract underlying mapped contracts which are internal configurations</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            var configs = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a6dd3bbb782ee22ae7a7be7a3907e82dc" title="The parameters instance to be used by the different XxxxFill() implementations">Parameters</a>.<a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModelParameters.html#aff6129dcf41708c253a667069cf11b79" title="Gets the SubscriptionDataConfig provider">ConfigProvider</a>.GetSubscriptionDataConfigs(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a3b72b42a193c52a586bd2b17c54fecf9" title="Symbol for the asset.">Symbol</a>, includeInternalConfigs: <span class="keyword">true</span>);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <span class="keywordflow">if</span> (configs.Count == 0)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<a class="code" href="classQuantConnect_1_1Messages.html" title="Provides user-facing message construction methods and static messages for the Algorithm....">Messages</a>.<a class="code" href="classQuantConnect_1_1Messages_1_1FillModel.html" title="Provides user-facing messages for the Orders.Fills.FillModel class and its consumers or related class...">FillModel</a>.NoDataSubscriptionFoundForFilling(asset));</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            var hasNonInternals = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            var exchangeOpenNonInternals = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            var exchangeOpenInternals = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; configs.Count; i++)</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                var config = configs[i];</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                <span class="keywordflow">if</span> (config.IsInternalFeed)</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                    exchangeOpenInternals |= config.ExtendedMarketHours;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                    hasNonInternals = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                    exchangeOpenNonInternals |= config.ExtendedMarketHours;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160; </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            <span class="keywordflow">if</span> (hasNonInternals)</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                <span class="comment">// give priority to non internals if any</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                <span class="keywordflow">return</span> IsExchangeOpen(asset, exchangeOpenNonInternals);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <span class="keywordflow">return</span> IsExchangeOpen(asset, exchangeOpenInternals);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">        /// This is required due to a limitation in PythonNet to resolved</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">        /// overriden methods. &lt;see cref=&quot;GetPrices&quot;/&gt;</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55"> 1014</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#ab0bcff6c774940b6b9403373586c3f55" title="This is required due to a limitation in PythonNet to resolved overriden methods. GetPrices">GetPricesCheckingPythonWrapper</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a> direction)</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        {</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a> != <span class="keyword">null</span>)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Python_1_1PythonWrapper.html" title="Provides extension methods for managing python wrapper classes">PythonWrapper</a>.GetPrices(asset, direction);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#afa84c82a93805830970d5a4c15ed646c" title="Get the minimum and maximum price for this security in the last bar:">GetPrices</a>(asset, direction);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">        /// Get the minimum and maximum price for this security in the last bar:</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">        /// &lt;param name=&quot;asset&quot;&gt;Security asset we&#39;re checking&lt;/param&gt;</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">        /// &lt;param name=&quot;direction&quot;&gt;The order direction, decides whether to pick bid or ask&lt;/param&gt;</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#afa84c82a93805830970d5a4c15ed646c"> 1028</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#afa84c82a93805830970d5a4c15ed646c" title="Get the minimum and maximum price for this security in the last bar:">GetPrices</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a> direction)</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        {</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            var low = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a2499f2dc7670d9dae4060915fd8baec4" title="If this uses tradebar data, return the most recent low.">Low</a>;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            var high = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a36ab3a6499e84ac1075603d633a99f0b" title="If this uses tradebar data, return the most recent high.">High</a>;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            var open = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#ac3994d265687a5789c08efb800fa5f59" title="If this uses tradebar data, return the most recent open.">Open</a>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            var close = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a68d15135905f405101da33061f0c3bc5" title="If this uses tradebar data, return the most recent close.">Close</a>;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            var current = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a69dc254a0f63d5c31165e03124a908c2" title="Get the current value of the security.">Price</a>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            var endTime = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>()?.EndTime ?? DateTime.MinValue;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordflow">if</span> (direction == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Hold)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a>(endTime, current, open, high, low, close);</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            <span class="comment">// Only fill with data types we are subscribed to</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            var subscriptionTypes = <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#a71f8f74b6d7f6180d711911667671c49" title="Get data types the Security is subscribed to">GetSubscribedTypes</a>(asset);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="comment">// Tick</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            var tick = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html" title="Tick class is the base representation for tick data. It is grouped into a Ticks object which implemen...">Tick</a>&gt;();</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <span class="keywordflow">if</span> (tick != <span class="keyword">null</span> &amp;&amp; subscriptionTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html" title="Tick class is the base representation for tick data. It is grouped into a Ticks object which implemen...">Tick</a>)))</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            {</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                var price = direction == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell ? tick.<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1Tick.html#aa510ea3520a6e7ff867aca8d4c6d1b4d" title="Bid Price for Tick">BidPrice</a> : tick.AskPrice;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                <span class="keywordflow">if</span> (price != 0m)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a>(tick.EndTime, price, 0, 0, 0, 0);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                }</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                <span class="comment">// If the ask/bid spreads are not available for ticks, try the price</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                price = tick.Price;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                <span class="keywordflow">if</span> (price != 0m)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                {</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a>(tick.EndTime, price, 0, 0, 0, 0);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            <span class="comment">// Quote</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            var quoteBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html" title="QuoteBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">QuoteBar</a>&gt;();</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            <span class="keywordflow">if</span> (quoteBar != <span class="keyword">null</span> &amp;&amp; subscriptionTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html" title="QuoteBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">QuoteBar</a>)))</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            {</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                var bar = direction == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Sell ? quoteBar.<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1QuoteBar.html#a1c6a6214e327028aec013a937c0befa4" title="Bid OHLC">Bid</a> : quoteBar.Ask;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                <span class="keywordflow">if</span> (bar != <span class="keyword">null</span>)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a>(quoteBar.EndTime, bar);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                }</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            <span class="comment">// Trade</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            var tradeBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a450a6de3d61c798d189201b39fbb765f" title="Data cache for the security to store previous price information.">Cache</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityCache.html#a2e22a721cbad979accb38e91dd640b8e" title="Get last data packet received for this security if any else null">GetData</a>&lt;<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>&gt;();</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            <span class="keywordflow">if</span> (tradeBar != <span class="keyword">null</span> &amp;&amp; subscriptionTypes.Contains(typeof(<a class="code" href="classQuantConnect_1_1Data_1_1Market_1_1TradeBar.html" title="TradeBar class for second and minute resolution data: An OHLC implementation of the QuantConnect Base...">TradeBar</a>)))</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            {</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a>(tradeBar);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1Prices.html" title="Prices class used by IFillModels">Prices</a>(endTime, current, open, high, low, close);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        }</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">        /// Determines if the exchange is open using the current time of the asset</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#acc205b791cf6a99fa989502aff6b53b8"> 1086</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Fills_1_1FillModel.html#acc205b791cf6a99fa989502aff6b53b8" title="Determines if the exchange is open using the current time of the asset">IsExchangeOpen</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> asset, <span class="keywordtype">bool</span> isExtendedMarketHours)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keywordflow">if</span> (!asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#ad5d411f6c563907f51580d0ab17a1643" title="Gets the SecurityExchangeHours for this exchange">Hours</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html#af2deedeacdcb6bbe40f4874002cdbac3" title="Determines if the exchange is open at the specified local date time.">IsOpen</a>(asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>, isExtendedMarketHours))</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                <span class="comment">// if we&#39;re not open at the current time exactly, check the bar size, this handle large sized bars (hours/days)</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                var currentBar = asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#ab93a58a84a4aa1b19d0972faf6c056c4" title="Get the last price update set to the security if any else null">GetLastData</a>();</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                <span class="keywordflow">if</span> (currentBar == <span class="keyword">null</span>)</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                var resolution = (currentBar.EndTime - currentBar.Time).ToHigherResolutionEquivalent(<span class="keyword">false</span>);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                var isOnCurrentBar = resolution == <a class="code" href="namespaceQuantConnect.html#a4d4c02d9045faf9f1f98c1bb011273c8" title="Resolution of data requested.">Resolution</a>.Daily</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                    <span class="comment">// for fill purposes we consider the market open for daily bars if we are in the same day</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                    ? asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a>.Date == currentBar.EndTime.Date</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                    <span class="comment">// for other resolution bars, market is considered open if we are within the bar time</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                    : asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#abac7f5c6c0ab3fd33a1fe0dc1f8babce" title="Local time for this market">LocalTime</a> &lt;= currentBar.EndTime;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160; </div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                <span class="keywordflow">return</span> isOnCurrentBar &amp;&amp; asset.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#a17daa159794484b17946fc540864800c" title="Determines if the exchange was open at any time between start and stop">IsOpenDuringBar</a>(currentBar.Time, currentBar.EndTime, isExtendedMarketHours);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        }</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="keyword">private</span> <span class="keyword">class </span>ComboLimitOrderLegParameters</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> <a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> <a class="code" href="classQuantConnect_1_1Orders_1_1Order.html" title="Order struct for placing new trade">Order</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <span class="keyword">public</span> Prices Prices { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">            /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">            /// Gets the current price that would be paid/received for this leg based on the security price and the leg quantity</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">            /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment"></span>            <span class="keyword">public</span> decimal Price</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                <span class="keyword">get</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                {</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                    <span class="comment">// we use the same, either low or high, for every leg depending on the combo direction</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                    var price = Order.GroupOrderManager.Direction == <a class="code" href="namespaceQuantConnect_1_1Orders.html#a135fa6f2408fe294416ba83911f9e54f" title="Direction of the order">OrderDirection</a>.Buy ? Prices.Low : Prices.High;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                    <span class="comment">// the limit price should be calculated using the ratios instead of the group quantities, like IB does</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                    var quantity = Order.Quantity.GetOrderLegRatio(Order.GroupOrderManager);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html" title="A base vehicle properties class for providing a common interface to all assets in QuantConnect.">Security</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a3b72b42a193c52a586bd2b17c54fecf9" title="Symbol for the asset.">Symbol</a>.<a class="code" href="classQuantConnect_1_1Symbol.html#a4b811550395ad9af00dacee29bde4125" title="Gets the security type of the symbol">SecurityType</a> == <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.Equity)</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                    {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                        quantity /= 100;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                    }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                    <span class="keywordflow">return</span> price * quantity;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            }</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        }</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    }</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_4ab6b4cc6a7edbff49100e9123df213f.html">Common</a></li><li class="navelem"><a class="el" href="dir_e293c2819ad1c039f06ccde4263a2c77.html">Orders</a></li><li class="navelem"><a class="el" href="dir_86a0f86b63074350ca2643b967affacc.html">Fills</a></li><li class="navelem"><b>FillModel.cs</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
